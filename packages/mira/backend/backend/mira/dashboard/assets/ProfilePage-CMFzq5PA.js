import{Q as U,e as I}from"./QBtn-BAUMkcPF.js";import{Q as S}from"./QInput-CydJIfK8.js";import{Q as M}from"./QCardSection-SJSJQflp.js";import{Q as D}from"./QCardActions-CSblNWnz.js";import{Q as F}from"./QBanner-CyliQJrf.js";import{Q as G}from"./QCard-CFaoD2xp.js";import{Q as j}from"./QPage-DGKX-s5K.js";import{ax as H,r as t,w as J,J as m,G as y,N as i,ag as q,K as c,H as a,a1 as K,ae as E,a3 as T,u as W,L as N,I as r,Q as A,O as B,a4 as Y,a7 as X,a2 as Z,R as ee}from"./main-DqiZ6KlG.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-id-eogJfon2.js";import"./use-dark-BvtvksB4.js";const ae=["src"],te=["disabled"],le={__name:"Avatar",props:["path","size"],emits:["upload","update:path"],setup($,{emit:w}){const x=$,{path:v,size:p}=H(x),Q=w,d=t(!1),g=t(""),f=t(),u=t(null),b=async()=>{try{const{data:l,error:o}=await E.storage.from("avatars").download(v.value);if(o)throw o;g.value=URL.createObjectURL(l)}catch(l){console.error("Error downloading image: ",l.message)}},_=()=>{u.value.click()},h=async l=>{f.value=l.target.files;try{if(d.value=!0,!f.value||f.value.length===0)throw new Error("You must select an image to upload.");const o=f.value[0],C=o.name.split(".").pop(),s=`${Math.random()}.${C}`;let{error:k}=await E.storage.from("avatars").upload(s,o);if(k)throw k;Q("update:path",s),Q("upload")}catch(o){alert(o.message)}finally{d.value=!1}};return J(v,()=>{v.value&&b()}),(l,o)=>(m(),y(K,null,[i("div",null,[g.value?(m(),y("img",{key:0,src:g.value,alt:"Avatar",class:"circle avatar image",style:q({height:c(p)+"em",width:c(p)+"em"})},null,12,ae)):(m(),y("div",{key:1,class:"avatar no-image",style:q({height:c(p)+"em",width:c(p)+"em"})},null,4))]),i("div",{style:q({width:c(p)+"em"})},[a(U,{flat:"",rounded:"",color:"primary",class:"upload-button q-mt-sm",disabled:d.value,icon:"upload",label:d.value?"Uploading ...":"Change Avatar",onClick:_},null,8,["disabled","label"]),i("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",ref_key:"fileInput",ref:u,onChange:h,disabled:d.value},null,40,te)],4)],64))}},oe=O(le,[["__scopeId","data-v-8981355a"]]),se={key:0,class:"profile-field q-mt-lg text-h5 text-center"},ne={class:"avatar-container"},re={key:0,class:"profile-field q-mt-lg"},ie={class:"profile-field"},de={class:"profile-field"},ue={class:"text-center q-mt-lg"},ce={__name:"ProfilePage",setup($){const{error:w,user:x,loading:v,getSignedInUser:p,getSignedInUserProfile:Q,signOut:d,updateUserProfile:g}=T(),f=Z(),u=t(v),b=t(""),_=t(""),h=t(""),l=t(!0),o=t(!1),C=t(),s=t(x);W(async()=>{C.value=await Q()});function k(){console.log("changed"),l.value=!1}async function R(){confirm("Are you sure you want to sign out?")&&await d()&&f.push("signin")}function L(){l.value=!1,o.value=!1}async function V(){if(console.log("updateProfile"),s.value){const P={id:x.id,username:b.value,website:_.value,avatar_url:h.value,updated_at:new Date};await g(P),console.log("Updated profile"),l.value=!0,o.value=!0}}return(P,e)=>{const z=ee("router-link");return m(),N(j,{class:"flex flex-center"},{default:r(()=>[a(G,{class:"my-card q-pa-lg"},{default:r(()=>[s.value?B("",!0):(m(),y("div",se,[e[7]||(e[7]=A(" Please ")),a(z,{to:"/signin"},{default:r(()=>e[6]||(e[6]=[A("sign in")])),_:1})])),i("form",{class:"form-widget",onSubmit:X(V,["prevent"]),onChange:e[5]||(e[5]=n=>L())},[a(M,{class:"text-center"},{default:r(()=>[i("div",ne,[a(oe,{path:h.value,"onUpdate:path":e[0]||(e[0]=n=>h.value=n),onUpload:V},null,8,["path"])]),s.value?(m(),y("div",re,[a(S,{outlined:"",id:"email",label:"Email",type:"text",modelValue:s.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.email=n),disable:"",class:"q-mb-md"},{prepend:r(()=>[a(I,{name:"email"})]),_:1},8,["modelValue"])])):B("",!0),i("div",ie,[a(S,{outlined:"",id:"username",label:"Name",modelValue:b.value,"onUpdate:modelValue":[e[2]||(e[2]=n=>b.value=n),k],class:"q-mb-md"},{prepend:r(()=>[a(I,{name:"person"})]),_:1},8,["modelValue"])]),i("div",de,[a(S,{outlined:"",id:"website",label:"Website",type:"url",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=n=>_.value=n),class:"q-mb-lg"},{prepend:r(()=>[a(I,{name:"language"})]),_:1},8,["modelValue"])])]),_:1}),a(D,{align:"center",class:"q-gutter-md"},{default:r(()=>[a(U,{padding:"sm md",unelevated:"",rounded:"",disabled:u.value||!s.value||l.value,type:"submit",color:"primary",onClick:e[4]||(e[4]=n=>V()),label:u.value?"Saving...":"Save Changes",loading:u.value,icon:"save"},null,8,["disabled","label","loading"]),a(U,{padding:"sm md",unelevated:"",rounded:"",onClick:R,disabled:u.value||!s.value,color:"negative",icon:"logout",label:"Sign Out"},null,8,["disabled"])]),_:1}),c(w)?(m(),N(F,{key:0,class:"bg-negative text-white q-mt-md"},{default:r(()=>[A(Y(c(w)),1)]),_:1})):B("",!0),i("div",ue,[a(U,{flat:"",rounded:"",to:"/dashboard/admin-blog",color:"primary",icon:"article",label:"Go to Blog"})])],32)]),_:1})]),_:1})}}},Qe=O(ce,[["__scopeId","data-v-b7ff690a"]]);export{Qe as default};
