import{U as w,l as u}from"./mainRouter-D1MtaxKQ.js";import{u as y}from"./useSupabase-BCNUvXZu.js";const b=w("posts",()=>{const s=u([]),l=u({}),{fetchPosts:d,downloadImage:f,getPost:C,deletePost:P,getComments:h}=y(),c="/dashboard/";console.log("PostsStore BASE_URL: ",c);const r=c+"images/placeholders/esaias-tan-MKvjc2kar7Q-unsplash.jpg",_=async()=>{console.log("loading posts...");const e=await d();if(!e){alert("fetchedPosts is null");return}console.log("fetchedPosts: ",e.length),s.value=e.map(o=>(o.liked=!1,o.image_url||(o.local_image=!0,o.image_url=r),o))},I=()=>r,n=e=>{const o=s.value.find(t=>t.id===e);return o||null},v=async e=>{await P(e),s.value=s.value.filter(o=>o.id!==e),alert("Post deleted successfully!")},p=async e=>{if(e.image)return console.log("Returning image from post: "+e.image),e.image;if(e.local_image||e.image_url.startsWith("/images"))return e.image_url;if(e.image_url){const o=`${e.image_url}-${e.image_size}`,t=i(o);if(t)return console.log("Returning cached image for post: "+t),t;console.log("Downloading image from URL: "+e.image_url);const a=await f(e.image_url);return g(o,a),e.image=a,m(e.id,a),console.log("Downloaded image and updated post:",e),a}return null},m=(e,o)=>{const t=s.value.findIndex(a=>a.id===e);t!==-1&&(s.value[t].image=o)},i=e=>l.value[e]||null,g=(e,o)=>{l.value[e]=o};return{posts:s,getPlaceholderImage:I,loadPosts:_,getImageForPost:p,getPostById:n,deletePost:v,updatePostImage:m,cacheImage:g,getCachedImage:i,updatePostComments:(e,o)=>{const t=n(e);t&&(t.comments||(t.comments=[]),t.comments.push(o))},getPostComments:async e=>{const o=await h(e),t=n(e);t&&(t.comments=o)}}});export{b as u};
