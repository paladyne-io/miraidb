import{Q as U}from"./QImg-H2fJ4B8o.js";import{Q as y}from"./QCardSection-CYgasTQA.js";import{Q as q}from"./QChip-B5fAKKlQ.js";import{Q as C}from"./QBtn-Dfw2kp-I.js";import{Q as z}from"./QCardActions-dUHmP9GC.js";import{Q as N}from"./QCard-DSFwVwpM.js";import{d as V}from"./date-C7HqJixX.js";import{u as E}from"./useSupabase-C9RX7rG1.js";import{U as Y,l as B,k as M,o as j,e as p,m as w,n,b as l,p as F,d as h,t as r,q as D,c as L,s as I}from"./mainRouter-D1MtaxKQ.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K=Y("posts",()=>{const o=B([]),u=B({}),{fetchPosts:g,downloadImage:P,getPost:a,deletePost:d,getComments:m}=E(),f="/dashboard/"+"images/placeholders/esaias-tan-MKvjc2kar7Q-unsplash.jpg",v=async()=>{const t=await g();o.value=t.map(e=>(e.liked=!1,e.image_url||(e.local_image=!0,e.image_url=f),e))},_=()=>f,i=t=>{const e=o.value.find(s=>s.id===t);return e||null},b=t=>{const e=o.value.findIndex(s=>s.id===t.id);e!==-1&&(o.value[e]=t)},k=async t=>{await d(t),o.value=o.value.filter(e=>e.id!==t),alert("Post deleted successfully!")},R=async t=>{if(t.image)return console.log("Returning image from post: "+t.image),t.image;if(t.local_image||t.image_url.startsWith("/images"))return t.image_url;if(t.image_url){const e=`${t.image_url}-${t.image_size}`,s=S(e);if(s)return console.log("Returning cached image for post: "+s),s;console.log("Downloading image from URL: "+t.image_url);const c=await P(t.image_url);return A(e,c),t.image=c,Q(t.id,c),console.log("Downloaded image and updated post:",t),c}return null},Q=(t,e)=>{const s=o.value.findIndex(c=>c.id===t);s!==-1&&(o.value[s].image=e)},S=t=>u.value[t]||null,A=(t,e)=>{u.value[t]=e};return{posts:o,loadPosts:v,getPlaceholderImage:_,getImageForPost:R,getPostById:i,editPost:b,deletePost:k,updatePostImage:Q,cacheImage:A,getCachedImage:S,updatePostComments:(t,e)=>{const s=i(t);s&&(s.comments||(s.comments=[]),s.comments.push(e))},getPostComments:async t=>{const e=await m(t),s=i(t);s&&(s.comments=e)}}}),T={class:"absolute-bottom text-h6 title"},$={class:"row items-center q-gutter-x-md"},O={class:"text-subtitle1"},W={class:"row fmt-date text-subtitle2"},G={key:0,class:"other-content-avail text-subtitle2"},J={__name:"BlogPost",props:{post:{type:Object,required:!0},showEditButtons:{type:Boolean,default:!1},isHero:{type:Boolean,default:!1}},emits:["edit-post","delete-post","view-post"],setup(o,{emit:u}){const g=K(),P=g.getPlaceholderImage,a=o,d=B(null),m=u;E();const x=M(()=>V.formatDate(a.post.created_at,"MMMM D, YYYY")),f=M(()=>a.post.content?a.post.content.length>150?a.post.content.substring(0,150)+"...":a.post.content:""),v=()=>{m("delete-post",a.post.id)},_=()=>{m("edit-post",a.post.id)},i=()=>{m("view-post",a.post.id)};return j(async()=>{a.post.image_url?d.value=await g.getImageForPost(a.post):d.value=P}),(b,k)=>(p(),w(N,{class:"my-card"},{default:n(()=>[l(y,{"no-padding":"",class:F(["top-section",{"hero-post":o.isHero}])},{default:n(()=>[l(U,{fit:"contain",src:d.value,class:"header-img",onClick:i},{default:n(()=>[h("div",T," yy "+r(o.post.title),1)]),_:1},8,["src"])]),_:1},8,["class"]),l(y,null,{default:n(()=>[h("div",$,[h("div",O,"by "+r(o.post.author||"Anonymous"),1),l(q,{color:"primary","text-color":"white",size:"sm"},{default:n(()=>[D(r(o.post.category||"Uncategorized"),1)]),_:1}),h("div",W,r(x.value),1),o.post.translation_language&&o.post.translation_language!=="english"?(p(),L("div",G," This content is also available in "+r(o.post.translation_language.charAt(0).toUpperCase()+o.post.translation_language.slice(1)),1)):I("",!0)])]),_:1}),l(y,{class:"q-pt-none"},{default:n(()=>[D(r(f.value),1)]),_:1}),l(z,{align:"right",class:"actions"},{default:n(()=>[o.showEditButtons?(p(),w(C,{key:0,flat:"",round:"",color:"orange",icon:"edit",onClick:_})):I("",!0),o.showEditButtons?(p(),w(C,{key:1,flat:"",round:"",color:"red",icon:"delete",onClick:v})):I("",!0),l(C,{flat:"",color:"primary",onClick:i,label:"Read More"})]),_:1})]),_:1}))}},dt=H(J,[["__scopeId","data-v-0780cdf2"]]);export{dt as B,K as u};
