import{Q as z}from"./QBtn-vqfJp63-.js";import{Q as se}from"./QCard-DH0HnGPs.js";import{r as _,C as V,u as oe,L as F,I as x,J as u,N as t,K as ne,O as S,x as p,ad as m,H as A,Q as E,G as g,a0 as M,a1 as q,a4 as k}from"./main-Cy-8TsDC.js";import{u as ie}from"./useSupabaseCategoryManagement-Dt_rCgPd.js";import{N as re}from"./NotSignedInComponent-DNLJYwHq.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-sALq2l4p.js";const v=i=>i.replace(/<[^>]*>/g,"").trim(),P=i=>{const n=[];return i.name?i.name.length<2?n.push("Category name must be at least 2 characters long"):i.name.length>50&&n.push("Category name cannot exceed 50 characters"):n.push("Category name is required"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},ce=i=>{const n=[];return i.name?i.name.length<2?n.push("Subcategory name must be at least 2 characters long"):i.name.length>50&&n.push("Subcategory name cannot exceed 50 characters"):n.push("Subcategory name is required"),i.categoryId||n.push("A parent category must be selected"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},de={class:"container"},ue={class:"category-section"},pe={class:"add-category-card"},me={class:"input-group"},ge={class:"categories-grid"},ye={class:"category-header"},ve={class:"category-actions"},fe=["onClick"],be=["onClick"],Ce={class:"category-description"},he={class:"subcategory-section"},_e={class:"add-subcategory-form"},Se={key:0,class:"input-group"},ke=["onUpdate:modelValue"],De=["onUpdate:modelValue"],we={class:"subcategories-list"},Ve={class:"subcategory-content"},xe={class:"subcategory-name"},Ne={class:"subcategory-actions"},Ue=["onClick"],Be=["onClick"],Ie={class:"subcategory-description"},ze={key:0,class:"modal"},Fe={class:"modal-content"},Ae={key:1,class:"modal"},Ee={class:"modal-content"},Me={__name:"CategoryManagerPage",setup(i){const{error:n,user:qe,isUserSignedIn:Q,fetchCurrentUser:$,fetchCategories:b,fetchSubCategories:D,addCategory:T,updateCategory:j,deleteCategory:L,addSubcategory:O,deleteSubcategory:G,updateSubcategory:H}=ie(),y=_([]),C=_([]),d=V({name:"",description:""});V({});const r=_(null),l=_(null),c=V({}),J=()=>{y.value.forEach(s=>{s.id in c||(c[s.id]={name:"",description:""})})},K=async()=>{const s=v(d.name),e=d.description?v(d.description):"",{isValid:a,errors:o}=P({name:s,description:e});if(!a){alert(o.join(`
`));return}await T(d.name,d.description)?(console.error("Add category success."),d.name="",d.description="",y.value=await b(),alert("The new category was added successfully.")):alert("Failed to add category.")},Y=async s=>{if(!confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))return;await L(s)?(console.error("Delete category success."),y.value=await b()):alert("Failed to delete category.")},R=s=>{r.value={...s}},N=async()=>{var h,w,B,I;if(!((h=r.value)!=null&&h.name.trim())){alert("Category name is required");return}const s=v((w=r.value)==null?void 0:w.name),e=(B=r.value)!=null&&B.description?v((I=r.value)==null?void 0:I.description):"",{isValid:a,errors:o}=P({name:s,description:e});if(!a){alert(o.join(`
`));return}await j(r.value.id,r.value.name,r.value.description)?(console.error("Update category success."),r.value=null,y.value=await b()):alert("Failed to update category.")},U=()=>{r.value=null},W=async s=>{console.log("addSubcategoryInDB categoryId: "+s),c[s]||(c[s]={name:"",description:""});const e=c[s],a=v(e.name),o=e.description?v(e.description):"",{isValid:f,errors:h}=ce({name:a,description:o,categoryId:s});if(!f){alert(h.join(`
`));return}if(!e.name||!e.name.trim()){alert("Subcategory name is required");return}await O(s,e.name,e.description)?(console.log("Added subcategory."),c[s].name="",c[s].description="",C.value=await D()):alert("Failed to add subcategory.")},X=async s=>{if(!confirm("Are you sure you want to delete this subcategory?"))return;await G(s)?(console.error("Delete subcategory success."),C.value=await D()):alert("Failed to delete subcategory.")},Z=s=>{l.value={...s}},ee=async()=>{var e;if(!((e=l.value)!=null&&e.name.trim())){alert("Subcategory name is required");return}await H(l.value.id,l.value.name,l.value.description)?(console.error("Update subcategory success."),l.value=null):alert("Failed to update subcategory.")},te=()=>{l.value=null},ae=async()=>{const s=await b();y.value=s||[];const e=await D();C.value=e||[],J()};return oe(async()=>{if(console.log("CategoryManagerPage mounted."),!await $()){alert("You must be signed in to Supabase to use this feature.");return}console.log("CategoryManagerPage mounted. Fetching categories..."),ae()}),(s,e)=>(u(),F(se,{class:"category-management"},{default:x(()=>[t("div",de,[e[13]||(e[13]=t("h2",{class:"page-title"},"Category Management",-1)),ne(Q)?S("",!0):(u(),F(re,{key:0})),t("div",ue,[t("div",pe,[e[7]||(e[7]=t("h3",{class:"category-title q-pb-md"},"Create a New Category",-1)),t("div",me,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.name=a),placeholder:"Category Name",type:"text",class:"form-input"},null,512),[[m,d.name]]),p(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.description=a),placeholder:"Category Description (Optional)",class:"form-textarea"},null,512),[[m,d.description]]),A(z,{onClick:K,class:"btn-primary"},{default:x(()=>e[6]||(e[6]=[t("i",{class:"fas fa-plus"},null,-1),E(" Add Category ")])),_:1}),t("div",{class:"modal-actions"},[t("button",{onClick:N},"Save"),t("button",{onClick:U},"Cancel")])])]),t("div",ge,[(u(!0),g(q,null,M(y.value,a=>(u(),g("div",{key:a.id,class:"category-card"},[t("div",ye,[t("h3",null,k(a.name),1),t("div",ve,[t("button",{onClick:o=>R(a),class:"btn-edit"},e[8]||(e[8]=[t("i",{class:"fas fa-edit"},null,-1)]),8,fe),t("button",{onClick:o=>Y(a.id),class:"btn-delete"},e[9]||(e[9]=[t("i",{class:"fas fa-trash"},null,-1)]),8,be)])]),t("p",Ce,k(a.description||"No description"),1),t("div",he,[t("div",_e,[c[a.id]?(u(),g("div",Se,[p(t("input",{"onUpdate:modelValue":o=>c[a.id].name=o,placeholder:"Subcategory Name",class:"form-input"},null,8,ke),[[m,c[a.id].name]]),p(t("textarea",{"onUpdate:modelValue":o=>c[a.id].description=o,placeholder:"Subcategory Description",class:"form-textarea"},null,8,De),[[m,c[a.id].description]]),A(z,{onClick:o=>W(a.id),class:"btn-secondary"},{default:x(()=>e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),E(" Add Subcategory ")])),_:2},1032,["onClick"])])):S("",!0)]),t("div",we,[(u(!0),g(q,null,M(C.value.filter(o=>o.category_id===a.id),o=>(u(),g("div",{key:o.id,class:"subcategory-item"},[t("div",Ve,[t("span",xe,k(o.name),1),t("div",Ne,[t("button",{onClick:f=>Z(o),class:"btn-edit-small"},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ue),t("button",{onClick:f=>X(o.id),class:"btn-delete-small"},e[12]||(e[12]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Be)])]),t("p",Ie,k(o.description||"No description"),1)]))),128))])])]))),128))])])]),r.value?(u(),g("div",ze,[t("div",Fe,[e[14]||(e[14]=t("h2",null,"Edit Category",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"Category Name"},null,512),[[m,r.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.description=a),placeholder:"Category Description"},null,512),[[m,r.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:N},"Save"),t("button",{onClick:U},"Cancel")])])])):S("",!0),l.value?(u(),g("div",Ae,[t("div",Ee,[e[15]||(e[15]=t("h2",null,"Edit Subcategory",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.name=a),placeholder:"Subcategory Name"},null,512),[[m,l.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),placeholder:"Subcategory Description"},null,512),[[m,l.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:ee},"Save"),t("button",{onClick:te},"Cancel")])])])):S("",!0)]),_:1}))}},Ge=le(Me,[["__scopeId","data-v-abc052ef"]]);export{Ge as default};
