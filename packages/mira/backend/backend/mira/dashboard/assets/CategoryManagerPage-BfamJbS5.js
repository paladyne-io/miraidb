import{Q as E}from"./QBtn-D6I3yaUk.js";import{Q as ae}from"./QCard-BZeChXVV.js";import{r as C,C as w,u as se,J as oe,G as V,H as u,L as t,E as p,F as x,x as m,aa as g,N as M,$ as A,_ as q,M as N,a4 as S}from"./main-pQ6I3G1N.js";import{u as ne,N as ie}from"./useSupabaseCategoryManagement-CsEupjNs.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-S6zrulGz.js";const v=i=>i.replace(/<[^>]*>/g,"").trim(),$=i=>{const n=[];return i.name?i.name.length<2?n.push("Category name must be at least 2 characters long"):i.name.length>50&&n.push("Category name cannot exceed 50 characters"):n.push("Category name is required"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},re=i=>{const n=[];return i.name?i.name.length<2?n.push("Subcategory name must be at least 2 characters long"):i.name.length>50&&n.push("Subcategory name cannot exceed 50 characters"):n.push("Subcategory name is required"),i.categoryId||n.push("A parent category must be selected"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},ce={class:"container"},de={key:0},ue={key:1,class:"category-section"},pe={class:"add-category-card"},me={class:"input-group"},ge={class:"categories-grid"},ye={class:"category-header"},ve={class:"category-actions"},fe=["onClick"],Ce=["onClick"],be={class:"category-description"},he={class:"subcategory-section"},_e={class:"add-subcategory-form"},Se={key:0,class:"input-group"},ke=["onUpdate:modelValue"],De=["onUpdate:modelValue"],we={class:"subcategories-list"},Ve={class:"subcategory-content"},xe={class:"subcategory-name"},Ne={class:"subcategory-actions"},Ue=["onClick"],Be=["onClick"],Ie={class:"subcategory-description"},Fe={key:0,class:"modal"},ze={class:"modal-content"},Ee={key:1,class:"modal"},Me={class:"modal-content"},Ae={__name:"CategoryManagerPage",setup(i){const{error:n,isUserSignedIn:qe,fetchCurrentUser:P,fetchCategories:b,fetchSubCategories:k,addCategory:Q,updateCategory:T,deleteCategory:j,addSubcategory:L,deleteSubcategory:G,updateSubcategory:H}=ne(),U=C(),y=C([]),h=C([]),d=w({name:"",description:""});w({});const l=C(null),r=C(null),c=w({}),J=()=>{y.value.forEach(s=>{s.id in c||(c[s.id]={name:"",description:""})})},O=async()=>{const s=v(d.name),e=d.description?v(d.description):"",{isValid:a,errors:o}=$({name:s,description:e});if(!a){alert(o.join(`
`));return}await Q(d.name,d.description)?(console.error("Add category success."),d.name="",d.description="",y.value=await b(),alert("The new category was added successfully.")):alert("Failed to add category.")},K=async s=>{if(!confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))return;await j(s)?(console.error("Delete category success."),y.value=await b()):alert("Failed to delete category.")},R=s=>{l.value={...s}},B=async()=>{var _,D,F,z;if(!((_=l.value)!=null&&_.name.trim())){alert("Category name is required");return}const s=v((D=l.value)==null?void 0:D.name),e=(F=l.value)!=null&&F.description?v((z=l.value)==null?void 0:z.description):"",{isValid:a,errors:o}=$({name:s,description:e});if(!a){alert(o.join(`
`));return}await T(l.value.id,l.value.name,l.value.description)?(console.error("Update category success."),l.value=null,y.value=await b()):alert("Failed to update category.")},I=()=>{l.value=null},W=async s=>{console.log("addSubcategoryInDB categoryId: "+s),c[s]||(c[s]={name:"",description:""});const e=c[s],a=v(e.name),o=e.description?v(e.description):"",{isValid:f,errors:_}=re({name:a,description:o,categoryId:s});if(!f){alert(_.join(`
`));return}if(!e.name||!e.name.trim()){alert("Subcategory name is required");return}await L(s,e.name,e.description)?(console.log("Added subcategory."),c[s].name="",c[s].description="",h.value=await k()):alert("Failed to add subcategory.")},X=async s=>{if(!confirm("Are you sure you want to delete this subcategory?"))return;await G(s)?(console.error("Delete subcategory success."),h.value=await k()):alert("Failed to delete subcategory.")},Y=s=>{r.value={...s}},Z=async()=>{var e;if(!((e=r.value)!=null&&e.name.trim())){alert("Subcategory name is required");return}await H(r.value.id,r.value.name,r.value.description)?(console.error("Update subcategory success."),r.value=null):alert("Failed to update subcategory.")},ee=()=>{r.value=null},te=async()=>{const s=await b();y.value=s||[];const e=await k();h.value=e||[],J()};return se(async()=>{console.log("CategoryManagerPage mounted."),U.value=await P(),console.log("CategoryManagerPage mounted. Fetching categories..."),te()}),(s,e)=>(u(),oe(ae,{flat:"",class:"category-management"},{default:V(()=>[t("div",ce,[e[13]||(e[13]=t("h2",{class:"page-title"},"Category Management",-1)),U.value?(u(),p("div",ue,[t("div",pe,[e[7]||(e[7]=t("h3",{class:"category-title q-pb-md"},"Create a New Category",-1)),t("div",me,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.name=a),placeholder:"Category Name",type:"text",class:"form-input"},null,512),[[g,d.name]]),m(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.description=a),placeholder:"Category Description (Optional)",class:"form-textarea"},null,512),[[g,d.description]]),x(E,{onClick:O,class:"btn-primary"},{default:V(()=>e[6]||(e[6]=[t("i",{class:"fas fa-plus"},null,-1),M(" Add Category ")])),_:1}),t("div",{class:"modal-actions"},[t("button",{onClick:B},"Save"),t("button",{onClick:I},"Cancel")])])]),t("div",ge,[(u(!0),p(A,null,q(y.value,a=>(u(),p("div",{key:a.id,class:"category-card"},[t("div",ye,[t("h3",null,S(a.name),1),t("div",ve,[t("button",{onClick:o=>R(a),class:"btn-edit"},e[8]||(e[8]=[t("i",{class:"fas fa-edit"},null,-1)]),8,fe),t("button",{onClick:o=>K(a.id),class:"btn-delete"},e[9]||(e[9]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Ce)])]),t("p",be,S(a.description||"No description"),1),t("div",he,[t("div",_e,[c[a.id]?(u(),p("div",Se,[m(t("input",{"onUpdate:modelValue":o=>c[a.id].name=o,placeholder:"Subcategory Name",class:"form-input"},null,8,ke),[[g,c[a.id].name]]),m(t("textarea",{"onUpdate:modelValue":o=>c[a.id].description=o,placeholder:"Subcategory Description",class:"form-textarea"},null,8,De),[[g,c[a.id].description]]),x(E,{onClick:o=>W(a.id),class:"btn-secondary"},{default:V(()=>e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),M(" Add Subcategory ")])),_:2},1032,["onClick"])])):N("",!0)]),t("div",we,[(u(!0),p(A,null,q(h.value.filter(o=>o.category_id===a.id),o=>(u(),p("div",{key:o.id,class:"subcategory-item"},[t("div",Ve,[t("span",xe,S(o.name),1),t("div",Ne,[t("button",{onClick:f=>Y(o),class:"btn-edit-small"},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ue),t("button",{onClick:f=>X(o.id),class:"btn-delete-small"},e[12]||(e[12]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Be)])]),t("p",Ie,S(o.description||"No description"),1)]))),128))])])]))),128))])])):(u(),p("div",de,[x(ie)]))]),l.value?(u(),p("div",Fe,[t("div",ze,[e[14]||(e[14]=t("h2",null,"Edit Category",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.name=a),placeholder:"Category Name"},null,512),[[g,l.value.name]]),m(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.description=a),placeholder:"Category Description"},null,512),[[g,l.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:B},"Save"),t("button",{onClick:I},"Cancel")])])])):N("",!0),r.value?(u(),p("div",Ee,[t("div",Me,[e[15]||(e[15]=t("h2",null,"Edit Subcategory",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.name=a),placeholder:"Subcategory Name"},null,512),[[g,r.value.name]]),m(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.description=a),placeholder:"Subcategory Description"},null,512),[[g,r.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:Z},"Save"),t("button",{onClick:ee},"Cancel")])])])):N("",!0)]),_:1}))}},Ge=le(Ae,[["__scopeId","data-v-a8aba578"]]);export{Ge as default};
