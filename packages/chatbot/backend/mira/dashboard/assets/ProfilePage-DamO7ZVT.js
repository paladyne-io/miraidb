import{Q as C,e as I}from"./QBtn-B0UveMgP.js";import{Q as S}from"./QInput-76Lxv6pr.js";import{Q as D}from"./QCardSection-CP00CtlP.js";import{Q as F}from"./QCardActions-Bayal1tl.js";import{Q as G}from"./QBanner-BtClFC6F.js";import{Q as j}from"./QCard-Ba-hqSnW.js";import{Q as H}from"./QPage-DsbrmFCl.js";import{ax as J,r as o,w as K,J as v,G as x,N as d,ag as q,K as p,H as a,a1 as T,ae as E,a3 as W,u as Y,L as N,I as u,Q as A,O as B,a4 as X,a7 as Z,a2 as ee,R as ae}from"./main-D70xbJ_r.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-id-BUabBO5m.js";import"./use-dark-l3Q-K3zH.js";const te=["src"],le=["disabled"],oe={__name:"Avatar",props:["path","size"],emits:["upload","update:path"],setup($,{emit:Q}){const f=$,{path:h,size:c}=J(f),k=Q,m=o(!1),w=o(""),g=o(),r=o(null),_=async()=>{try{const{data:s,error:n}=await E.storage.from("avatars").download(h.value);if(n)throw n;w.value=URL.createObjectURL(s)}catch(s){console.error("Error downloading image: ",s.message)}},b=()=>{r.value.click()},y=async s=>{g.value=s.target.files;try{if(m.value=!0,!g.value||g.value.length===0)throw new Error("You must select an image to upload.");const n=g.value[0],P=n.name.split(".").pop(),t=`${Math.random()}.${P}`;let{error:U}=await E.storage.from("avatars").upload(t,n);if(U)throw U;k("update:path",t),k("upload")}catch(n){alert(n.message)}finally{m.value=!1}};return K(h,()=>{h.value&&_()}),(s,n)=>(v(),x(T,null,[d("div",null,[w.value?(v(),x("img",{key:0,src:w.value,alt:"Avatar",class:"circle avatar image",style:q({height:p(c)+"em",width:p(c)+"em"})},null,12,te)):(v(),x("div",{key:1,class:"avatar no-image",style:q({height:p(c)+"em",width:p(c)+"em"})},null,4))]),d("div",{style:q({width:p(c)+"em"})},[a(C,{flat:"",rounded:"",color:"primary",class:"upload-button q-mt-sm",disabled:m.value,icon:"upload",label:m.value?"Uploading ...":"Change Avatar",onClick:b},null,8,["disabled","label"]),d("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",ref_key:"fileInput",ref:r,onChange:y,disabled:m.value},null,40,le)],4)],64))}},se=O(oe,[["__scopeId","data-v-8981355a"]]),ne={key:0,class:"profile-field q-mt-lg text-h5 text-center"},re={class:"avatar-container"},ie={key:0,class:"profile-field q-mt-lg"},ue={class:"profile-field"},de={class:"profile-field"},ce={class:"text-center q-mt-lg"},me={__name:"ProfilePage",setup($){const{error:Q,user:f,loading:h,getSignedInUser:c,getSignedInUserProfile:k,signOut:m,updateUserProfile:w}=W(),g=ee(),r=o(h),_=o(""),b=o(""),y=o(""),s=o(!0),n=o(!1),P=o(),t=o(f);Y(async()=>{await z()});function U(){console.log("changed"),s.value=!1}async function R(){confirm("Are you sure you want to sign out?")&&await m()&&g.push("signin")}function L(){s.value=!1,n.value=!1}async function z(){try{if(r.value=!0,f||(t.value=await c()),!f||!t.value)return;console.log("get user Profile");const l=await k();P.value=l,l&&(_.value=l.username,b.value=l.website,y.value=l.avatar_url)}catch(l){l.value=l.message}finally{r.value=!1}}async function V(){if(console.log("updateProfile"),t.value){const l={id:f.id,username:_.value,website:b.value,avatar_url:y.value,updated_at:new Date};await w(l),console.log("Updated profile"),s.value=!0,n.value=!0}}return(l,e)=>{const M=ae("router-link");return v(),N(H,{class:"flex flex-center"},{default:u(()=>[a(j,{class:"my-card q-pa-lg"},{default:u(()=>[t.value?B("",!0):(v(),x("div",ne,[e[7]||(e[7]=A(" Please ")),a(M,{to:"/signin"},{default:u(()=>e[6]||(e[6]=[A("sign in")])),_:1})])),d("form",{class:"form-widget",onSubmit:Z(V,["prevent"]),onChange:e[5]||(e[5]=i=>L())},[a(D,{class:"text-center"},{default:u(()=>[d("div",re,[a(se,{path:y.value,"onUpdate:path":e[0]||(e[0]=i=>y.value=i),onUpload:V},null,8,["path"])]),t.value?(v(),x("div",ie,[a(S,{outlined:"",id:"email",label:"Email",type:"text",modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.email=i),disable:"",class:"q-mb-md"},{prepend:u(()=>[a(I,{name:"email"})]),_:1},8,["modelValue"])])):B("",!0),d("div",ue,[a(S,{outlined:"",id:"username",label:"Name",modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=i=>_.value=i),U],class:"q-mb-md"},{prepend:u(()=>[a(I,{name:"person"})]),_:1},8,["modelValue"])]),d("div",de,[a(S,{outlined:"",id:"website",label:"Website",type:"url",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=i=>b.value=i),class:"q-mb-lg"},{prepend:u(()=>[a(I,{name:"language"})]),_:1},8,["modelValue"])])]),_:1}),a(F,{align:"center",class:"q-gutter-md"},{default:u(()=>[a(C,{padding:"sm md",unelevated:"",rounded:"",disabled:r.value||!t.value||s.value,type:"submit",color:"primary",onClick:e[4]||(e[4]=i=>V()),label:r.value?"Saving...":"Save Changes",loading:r.value,icon:"save"},null,8,["disabled","label","loading"]),a(C,{padding:"sm md",unelevated:"",rounded:"",onClick:R,disabled:r.value||!t.value,color:"negative",icon:"logout",label:"Sign Out"},null,8,["disabled"])]),_:1}),p(Q)?(v(),N(G,{key:0,class:"bg-negative text-white q-mt-md"},{default:u(()=>[A(X(p(Q)),1)]),_:1})):B("",!0),d("div",ce,[a(C,{flat:"",rounded:"",to:"/blog",color:"primary",icon:"article",label:"Go to Blog"})])],32)]),_:1})]),_:1})}}},ke=O(me,[["__scopeId","data-v-0d98d916"]]);export{ke as default};
