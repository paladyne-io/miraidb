import{Q as C,a as q}from"./QBtn-Dfw2kp-I.js";import{Q as S}from"./QInput-WPBEwenM.js";import{Q as M}from"./QCardSection-CYgasTQA.js";import{Q as D}from"./QCardActions-dUHmP9GC.js";import{Q as W}from"./QBanner-Ci3QfL4v.js";import{Q as Y}from"./QCard-DSFwVwpM.js";import{Q as j}from"./QPage-D40g0nkh.js";import{V as G,l as o,w as T,e as f,c as k,d,W as I,a as p,b as a,F as X,X as E,u as H,o as J,r as K,m as N,n as u,q as A,s as B,t as Z,Y as ee}from"./mainRouter-D1MtaxKQ.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ae}from"./useSupabase-C9RX7rG1.js";import"./use-id-DMSnSmkA.js";import"./use-dark-0IRRmxwP.js";import"./private.use-form-D5cE26cE.js";const te=["src"],le=["disabled"],oe={__name:"Avatar",props:["path","size"],emits:["upload","update:path"],setup($,{emit:x}){const v=$,{path:h,size:c}=G(v),Q=x,m=o(!1),w=o(""),g=o(),r=o(null),_=async()=>{try{const{data:s,error:n}=await E.storage.from("avatars").download(h.value);if(n)throw n;w.value=URL.createObjectURL(s)}catch(s){console.error("Error downloading image: ",s.message)}},b=()=>{r.value.click()},y=async s=>{g.value=s.target.files;try{if(m.value=!0,!g.value||g.value.length===0)throw new Error("You must select an image to upload.");const n=g.value[0],P=n.name.split(".").pop(),t=`${Math.random()}.${P}`;let{error:U}=await E.storage.from("avatars").upload(t,n);if(U)throw U;Q("update:path",t),Q("upload")}catch(n){alert(n.message)}finally{m.value=!1}};return T(h,()=>{h.value&&_()}),(s,n)=>(f(),k(X,null,[d("div",null,[w.value?(f(),k("img",{key:0,src:w.value,alt:"Avatar",class:"circle avatar image",style:I({height:p(c)+"em",width:p(c)+"em"})},null,12,te)):(f(),k("div",{key:1,class:"avatar no-image",style:I({height:p(c)+"em",width:p(c)+"em"})},null,4))]),d("div",{style:I({width:p(c)+"em"})},[a(C,{flat:"",rounded:"",color:"primary",class:"upload-button q-mt-sm",disabled:m.value,icon:"upload",label:m.value?"Uploading ...":"Change Avatar",onClick:b},null,8,["disabled","label"]),d("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",ref_key:"fileInput",ref:r,onChange:y,disabled:m.value},null,40,le)],4)],64))}},se=O(oe,[["__scopeId","data-v-6951234a"]]),ne={key:0,class:"profile-field q-mt-lg text-h5 text-center"},re={class:"avatar-container"},ie={key:0,class:"profile-field q-mt-lg"},ue={class:"profile-field"},de={class:"profile-field"},ce={class:"text-center q-mt-lg"},me={__name:"ProfilePage",setup($){const{error:x,user:v,loading:h,getSignedInUser:c,getSignedInUserProfile:Q,signOut:m,updateUserProfile:w}=ae(),g=H(),r=o(h),_=o(""),b=o(""),y=o(""),s=o(!0),n=o(!1),P=o(),t=o(v);J(async()=>{await F()});function U(){console.log("changed"),s.value=!1}async function R(){confirm("Are you sure you want to sign out?")&&await m()&&g.push("signin")}function z(){s.value=!1,n.value=!1}async function F(){try{if(r.value=!0,v||(t.value=await c()),!v||!t.value)return;console.log("get user Profile");const l=await Q();P.value=l,l&&(_.value=l.username,b.value=l.website,y.value=l.avatar_url)}catch(l){l.value=l.message}finally{r.value=!1}}async function V(){if(console.log("updateProfile"),t.value){const l={id:v.id,username:_.value,website:b.value,avatar_url:y.value,updated_at:new Date};await w(l),console.log("Updated profile"),s.value=!0,n.value=!0}}return(l,e)=>{const L=K("router-link");return f(),N(j,{class:"flex flex-center"},{default:u(()=>[a(Y,{class:"my-card q-pa-lg"},{default:u(()=>[t.value?B("",!0):(f(),k("div",ne,[e[7]||(e[7]=A(" Please ")),a(L,{to:"/signin"},{default:u(()=>e[6]||(e[6]=[A("sign in")])),_:1})])),d("form",{class:"form-widget",onSubmit:ee(V,["prevent"]),onChange:e[5]||(e[5]=i=>z())},[a(M,{class:"text-center"},{default:u(()=>[d("div",re,[a(se,{path:y.value,"onUpdate:path":e[0]||(e[0]=i=>y.value=i),onUpload:V},null,8,["path"])]),t.value?(f(),k("div",ie,[a(S,{outlined:"",id:"email",label:"Email",type:"text",modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.email=i),disable:"",class:"q-mb-md"},{prepend:u(()=>[a(q,{name:"email"})]),_:1},8,["modelValue"])])):B("",!0),d("div",ue,[a(S,{outlined:"",id:"username",label:"Name",modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=i=>_.value=i),U],class:"q-mb-md"},{prepend:u(()=>[a(q,{name:"person"})]),_:1},8,["modelValue"])]),d("div",de,[a(S,{outlined:"",id:"website",label:"Website",type:"url",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=i=>b.value=i),class:"q-mb-lg"},{prepend:u(()=>[a(q,{name:"language"})]),_:1},8,["modelValue"])])]),_:1}),a(D,{align:"center",class:"q-gutter-md"},{default:u(()=>[a(C,{padding:"sm md",unelevated:"",rounded:"",disabled:r.value||!t.value||s.value,type:"submit",color:"primary",onClick:e[4]||(e[4]=i=>V()),label:r.value?"Saving...":"Save Changes",loading:r.value,icon:"save"},null,8,["disabled","label","loading"]),a(C,{padding:"sm md",unelevated:"",rounded:"",onClick:R,disabled:r.value||!t.value,color:"negative",icon:"logout",label:"Sign Out"},null,8,["disabled"])]),_:1}),p(x)?(f(),N(W,{key:0,class:"bg-negative text-white q-mt-md"},{default:u(()=>[A(Z(p(x)),1)]),_:1})):B("",!0),d("div",ce,[a(C,{flat:"",rounded:"",to:"/blog",color:"primary",icon:"article",label:"Go to Blog"})])],32)]),_:1})]),_:1})}}},Ce=O(me,[["__scopeId","data-v-003156f9"]]);export{Ce as default};
