const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-yJeh5-W9.css"])))=>i.map(i=>d[i]);
import{Q as pe}from"./QPage-DsbrmFCl.js";import{e as ae,Q as Y}from"./QBtn-B0UveMgP.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a3 as Z,r as a,a as q,u as J,J as x,L as I,I as d,H as o,N as m,G as N,a1 as oe,a0 as se,Q as R,a4 as D,O as H,a5 as me,a6 as ve,a7 as ee,a8 as ge,K as fe}from"./main-D70xbJ_r.js";import{Q as z}from"./option-sizes-jNTISUTl.js";import{a as ne,b as te,Q as W}from"./QItemSection-CTwcXflL.js";import{Q as ye,a as _e,_ as he}from"./RagToolComponent.vue_vue_type_style_index_0_scoped_72991f44_lang-l8EPjkWF.js";import{Q as le}from"./QList-CPEtvzrH.js";import{Q as K}from"./QCardSection-CP00CtlP.js";import{Q as E}from"./QCard-Ba-hqSnW.js";import{Q as re}from"./QInput-76Lxv6pr.js";import{Q as Ce}from"./QBanner-BtClFC6F.js";import{Q as be}from"./QExpansionItem-loKbMy5O.js";import{u as xe}from"./useSupabaseCategoryManagement-DvGPHxDP.js";import"./QChip-BuJe_tKZ.js";import"./use-dark-l3Q-K3zH.js";import"./selection-Dye4wwRV.js";import"./format-BuuxhBpC.js";import"./use-id-BUabBO5m.js";const we={class:"contexts-list q-pb-sm"},Se={class:"row items-center full-width"},Te={class:"col"},Pe={key:0,class:"col-shrink"},Ie={__name:"RAGToolCategorySidePanel",emits:["update:selectedContexts"],setup(U,{emit:s}){const p=s,{fetchCategories:y,fetchSubCategories:f,fetchSavedContexts:c,SaveContextData:C}=Z();a(""),a(""),a("");const _=a("");a(!1),a(null);const v=a([]),b=a([]),w=a(null),$=a(null),k=a([]),h=a([]),S=q(()=>b.value.filter(u=>{var i;return u.category_id===((i=w.value)==null?void 0:i.id)})),F=u=>{const i=v.value.find(l=>l.id===u.category_id),e=b.value.find(l=>l.id===u.sub_category_id);return`${(i==null?void 0:i.name)||"Uncategorized"}${e?` - ${e.name}`:""}`},V=q(()=>k.value.filter(u=>{const i=!w.value||u.category_id===w.value.id,e=!$.value||u.sub_category_id===$.value.id;return i&&e}));J(async()=>{try{v.value=await y(),b.value=await f(),k.value=await c()}catch(u){_.value=`Initialization error: ${u.message}`}});const A=()=>{$.value=null},j=u=>h.value.includes(u),O=u=>{const i=typeof u=="object"?u.id:u;h.value.includes(i)?h.value=h.value.filter(e=>e!==i):h.value.push(i),p("update:selectedContexts",h.value)},B=u=>{h.value=u,p("update:selectedContexts",u)},L=q(()=>{const u={};return k.value.forEach(i=>{const e=v.value.find(r=>r.id===i.category_id),l=b.value.find(r=>r.id===i.sub_category_id);if(e){u[e.id]||(u[e.id]={id:e.id,label:e.name,type:"category",children:[]});let r=l?u[e.id].children.find(G=>G.id===l.id):null;l&&!r&&(r={id:l.id,label:l.name,type:"subcategory",children:[]},u[e.id].children.push(r));const T={id:i.id,label:i.original_url,type:"context",original_url:i.original_url};r?(r.children||(r.children=[]),r.children.push(T)):u[e.id].children.push(T)}}),Object.values(u)});return(u,i)=>(x(),I(E,null,{default:d(()=>[o(K,null,{default:d(()=>[i[3]||(i[3]=m("div",{class:"text-h6"},"Categories",-1)),o(z,{class:"q-mb-md",modelValue:w.value,"onUpdate:modelValue":[i[0]||(i[0]=e=>w.value=e),A],options:v.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),o(z,{class:"q-mb-md",modelValue:$.value,"onUpdate:modelValue":i[1]||(i[1]=e=>$.value=e),options:S.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!w.value,outlined:"",dense:""},null,8,["modelValue","options","disable"]),m("div",we,[i[2]||(i[2]=m("div",{class:"text-h6"},"Saved Contexts",-1)),o(le,{bordered:"",separator:""},{default:d(()=>[(x(!0),N(oe,null,se(V.value,e=>(x(),I(ne,{key:e.id,clickable:"",onClick:l=>O(e)},{default:d(()=>[o(te,null,{default:d(()=>[o(W,null,{default:d(()=>[R(D(e.original_url),1)]),_:2},1024),o(W,{caption:""},{default:d(()=>[R(D(F(e)),1)]),_:2},1024)]),_:2},1024),o(te,{side:""},{default:d(()=>[o(ye,{"model-value":j(e.id),"onUpdate:modelValue":l=>O(e)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),o(_e,{nodes:L.value,"node-key":"id","label-key":"label","children-key":"children","default-expand-all":"","tick-strategy":"leaf",ticked:h.value,"onUpdate:ticked":B,class:"contexts-tree q-mt-md"},{"default-header":d(e=>[m("div",Se,[m("div",Te,D(e.node.label),1),e.node.type==="context"?(x(),N("div",Pe,[o(ae,{name:"link",title:e.node.original_url,class:"q-ml-xs"},null,8,["title"])])):H("",!0)])]),_:1},8,["nodes","ticked"])]),_:1})]),_:1}))}},ie=X(Ie,[["__scopeId","data-v-10a97c3d"]]);class $e{static async processPDF(s){try{const p=await s.arrayBuffer(),y=await he(p).promise;let f="";for(let c=1;c<=y.numPages;c++){const v=(await(await y.getPage(c)).getTextContent()).items.map(b=>b.str).join(" ");f+=v+`
`}return{text:f.trim(),metadata:{originalFileName:s.name,fileType:s.type,fileSize:s.size}}}catch(p){throw console.error("PDF processing error:",p),new Error("Failed to process PDF file")}}static async processTextFile(s){return new Promise((p,y)=>{const f=new FileReader;f.onload=c=>{var _;const C=(_=c.target)==null?void 0:_.result;p({text:C.trim(),metadata:{originalFileName:s.name,fileType:s.type,fileSize:s.size}})},f.onerror=y,f.readAsText(s)})}static async processHTMLFile(s){return new Promise((p,y)=>{const f=new FileReader;f.onload=c=>{var b;const C=(b=c.target)==null?void 0:b.result,_=document.createElement("div");_.innerHTML=C;const v=_.textContent||_.innerText;p({text:v.trim(),metadata:{originalFileName:s.name,fileType:s.type,fileSize:s.size}})},f.onerror=y,f.readAsText(s)})}static async processRTFFile(s){return new Promise((p,y)=>{const f=new FileReader;f.onload=c=>{var v;const _=((v=c.target)==null?void 0:v.result).replace(/\\[a-z]{1,32}(-)?|\{|\}|\\\n?/gm,"").replace(/[\\{}]/g,"").replace(/[\r\n]+/g," ");p({text:_.trim(),metadata:{originalFileName:s.name,fileType:s.type,fileSize:s.size}})},f.onerror=y,f.readAsText(s)})}static async processDOCXFile(s){try{const p=await me(()=>import("./index-CY0cnBSY.js").then(c=>c.i),__vite__mapDeps([0])),y=await s.arrayBuffer();return{text:(await p.extractRawText({arrayBuffer:y})).value.trim(),metadata:{originalFileName:s.name,fileType:s.type,fileSize:s.size}}}catch(p){throw console.error("DOCX processing error:",p),new Error("Failed to process DOCX file")}}static async processFile(s){const y={"application/pdf":this.processPDF,"text/plain":this.processTextFile,"text/html":this.processHTMLFile,"text/rtf":this.processRTFFile,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":this.processDOCXFile}[s.type];if(y)return await y(s);throw new Error(`Unsupported file type: ${s.type}`)}}const Fe={class:"file-upload-section"},ke={class:"row items-center url-input-section q-mb-md"},Ve={class:"col-8"},Ae={class:"col"},Re={class:"file-input-section q-mb-md"},De={class:"category-selection"},Ue={class:"q-pt-md"},Qe={__name:"RAGToolAIContextManager",setup(U){const{fetchCategories:s,fetchSubCategories:p,fetchSavedContexts:y,SaveContextData:f}=Z();a("");const c=a("test"),C=a(""),_=a(""),v=a(""),b=a(!1),w=a(null),$=a([]),k=a([]),h=a(null),S=a(null),F=a([]);a([{}]);const V=q(()=>C.value&&h.value);J(async()=>{try{$.value=await s(),k.value=await p(),F.value=await y()}catch(n){v.value=`Initialization error: ${n.message}`}});const A=q(()=>k.value.filter(n=>{var t;return n.category_id===((t=h.value)==null?void 0:t.id)}));q(()=>F.value.filter(n=>{const t=!h.value||n.category_id===h.value.id,g=!S.value||n.sub_category_id===S.value.id;return t&&g}));const j=()=>{S.value=null},O=()=>{C.value="",c.value="",S.value=null,w.value&&(w.value.value="")},B=(n,t=500)=>n.length>t?n.substring(0,t)+"...":n,L=n=>{n.preventDefault(),b.value=!0},u=()=>{b.value=!1},i=async n=>{if(b.value=!1,n.preventDefault(),console.log("handleDrop.. "),n.dataTransfer.files.length>0){const g=n.dataTransfer.files[0];if(console.log("Processing a dropped file.. ",g),console.log("file type:",g.type),!g.name.endsWith(".webloc"))try{await l(g)}catch(P){console.error("File drop processing error:",P),v.value=P.message}return}const t=n.dataTransfer.getData("text/plain");t&&(console.log("droppedUrl: ",t),c.value=t,r())},e=async n=>{const t=n.target.files[0];t&&await l(t)},l=async n=>{try{const t=await $e.processFile(n);C.value=t.text,v.value=""}catch(t){v.value=`File processing error: ${t.message}`}},r=async()=>{if(!c.value){v.value="Please enter a valid URL";return}try{const t=await(await fetch(c.value)).text(),P=new DOMParser().parseFromString(t,"text/html"),M=T(P).join(`

`);_.value=G(M),C.value=_,v.value=""}catch(n){v.value=`URL extraction error: ${n.message}`}},T=n=>{const t=[()=>{const g=["main","article",".main-content","#main-content",".content","#content"];for(let P of g){const Q=n.querySelector(P);if(Q)return Array.from(Q.querySelectorAll("p, h1, h2, h3, h4, h5, h6")).map(M=>M.textContent.trim()).filter(M=>M.length>0)}return[]},()=>Array.from(n.querySelectorAll("p")).map(g=>g.textContent.trim()).filter(g=>g.length>0)];for(let g of t){const P=g();return P.length>0?P:[]}},G=n=>{if(!n||n.length===0)return"No content could be extracted.";const t=n.split(`

`);if(t.length<=3)return n;const g=[],P=["summary","key points","main idea","important","conclusion","highlights","overview"];return t.forEach(Q=>{const M=Q.toLowerCase();(P.some(de=>M.includes(de))||Q.length>100)&&g.push(Q)}),g.length===0&&g.push(...t.slice(0,3)),g.join(`

`)},ue=async()=>{var n;if(!V.value){v.value="Please select a category and provide content";return}try{const t=await f(c.value||"Uploaded Content",C.value,C.value.length/1e3,h.value.id,(n=S.value)==null?void 0:n.id);F.value.push(t),O()}catch(t){v.value=`Save as context error: ${t.message}`}};return(n,t)=>(x(),I(E,{class:"col-8 extraction-section"},{default:d(()=>[o(K,null,{default:d(()=>[t[6]||(t[6]=m("h5",null,"Extract and Manage AI Context",-1)),m("div",Fe,[m("div",{class:ve(["drop-zone",{"drag-active":b.value}]),onDragover:ee(L,["prevent"]),onDragleave:ee(u,["prevent"]),onDrop:ee(i,["prevent"])},t[3]||(t[3]=[m("p",null,"Drag and Drop a URL (web link) or file Here",-1)]),34),m("div",ke,[m("div",Ve,[o(re,{class:"col q-ma-sm",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=g=>c.value=g),placeholder:"Enter URL to extract text",onKeyup:ge(r,["enter"])},null,8,["modelValue"])]),m("div",Ae,[o(Y,{class:"q-ma-sm",onClick:r,disabled:!c.value,color:"primary"},{default:d(()=>t[4]||(t[4]=[R(" Extract URL Text ")])),_:1},8,["disabled"])])]),m("div",Re,[m("input",{type:"file",ref_key:"fileInput",ref:w,onChange:e,accept:".pdf,.txt,.html,.rtf,.docx,.md"},null,544)]),v.value?(x(),I(Ce,{key:0,class:"bg-negative text-white q-mb-md"},{default:d(()=>[R(D(v.value),1)]),_:1})):H("",!0),C.value?(x(),I(be,{key:1,label:"Extracted Content Preview","default-opened":"",class:"q-mb-md"},{default:d(()=>[o(E,null,{default:d(()=>[o(K,null,{default:d(()=>[m("div",null,D(B(C.value)),1)]),_:1})]),_:1})]),_:1})):H("",!0)]),m("div",De,[o(z,{modelValue:h.value,"onUpdate:modelValue":[t[1]||(t[1]=g=>h.value=g),j],options:$.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),o(z,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=g=>S.value=g),options:A.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!h.value,outlined:"",dense:""},null,8,["modelValue","options","disable"])]),m("div",Ue,[o(Y,{onClick:ue,color:"positive",disable:!V.value,class:"q-mb-md"},{default:d(()=>t[5]||(t[5]=[R(" Save Context ")])),_:1},8,["disable"])])]),_:1})]),_:1}))}},ce=X(Qe,[["__scopeId","data-v-3e638f7f"]]),Me={key:0,class:"selected-contexts q-mb-md"},qe={class:"ai-query-section"},ze={__name:"RAGToolAIInteractionComponent",props:{selectedContexts:{type:Array,default:()=>[]}},setup(U){const s=U,{fetchCategories:p,fetchSubCategories:y,fetchSavedContexts:f}=Z(),c=a(""),C=a([]),_=a([]),v=a([]),b=a(""),w=a("openai"),$=["openai","anthropic"],k=a("gpt-4o-mini"),h=a(["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"]),S=a(null),F=a(null),V=a(["Combine in Prompt"]),A=a("Combine in Prompt");new AbortController;const j="https://virtag-ai.fly.dev";J(async()=>{try{C.value=await p(),_.value=await y(),v.value=await f()}catch(e){c.value=`Initialization error: ${e.message}`}});const O=()=>{console.log("updateAIServiceOptions: "+w.value),w.value==="openai"?(h.value=["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"],V.value=["Combine in Prompt","Upload as Files"],A.value="Combine in Prompt"):w.value==="anthropic"&&(h.value=["claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-opus-20240229"],V.value=["Combine in Prompt"],A.value="Combine in Prompt"),console.log("contextProcessingOptions: "+V.value)},B=()=>V.value,L=q(()=>v.value.filter(e=>s.selectedContexts.includes(e.id))),u=e=>{const l=C.value.find(T=>T.id===e.category_id),r=_.value.find(T=>T.id===e.sub_category_id);return`${(l==null?void 0:l.name)||"Uncategorized"}${r?` - ${r.name}`:""}`},i=async()=>{try{const e=`${j}/api/openai`;if(!F.value){const G=await(await fetch(`${e}/createThread`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();F.value=G.id}const l=await fetch(`${e}/addMessageToThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:F.value,content:b.value})}),r=await fetch(`${e}/runThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:F.value,assistantId:"your_assistant_id"})});S.value=await r.json().then(T=>T.response)}catch(e){e.name==="AbortError"?c.value="Request was canceled":c.value=`AI query error: ${e.message}`,console.error(e)}};return(e,l)=>(x(),I(E,{class:"col-8 extraction-section"},{default:d(()=>[o(K,null,{default:d(()=>[L.value.length>0?(x(),N("div",Me,[l[4]||(l[4]=m("div",{class:"text-h6"},"Selected Contexts",-1)),o(le,{bordered:"",separator:""},{default:d(()=>[(x(!0),N(oe,null,se(L.value,r=>(x(),I(ne,{key:r.id},{default:d(()=>[o(te,null,{default:d(()=>[o(W,null,{default:d(()=>[R(D(r.original_url),1)]),_:2},1024),o(W,{caption:""},{default:d(()=>[R(D(u(r)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):H("",!0),m("div",qe,[o(z,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=r=>A.value=r),options:B(),label:"Context Processing Method",class:"q-mb-md"},null,8,["modelValue","options"]),o(re,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=r=>b.value=r),label:"AI Query",outlined:"",type:"textarea",class:"q-mb-md"},null,8,["modelValue"]),o(z,{modelValue:w.value,"onUpdate:modelValue":[l[2]||(l[2]=r=>w.value=r),O],options:$,label:"AI Service",class:"q-mb-md"},null,8,["modelValue"]),o(z,{modelValue:k.value,"onUpdate:modelValue":l[3]||(l[3]=r=>k.value=r),options:h.value,label:"AI Model",class:"q-mb-md"},null,8,["modelValue","options"]),o(Y,{onClick:i,color:"primary",disable:!b.value},{default:d(()=>l[5]||(l[5]=[R(" Send to AI ")])),_:1},8,["disable"]),S.value?(x(),I(E,{key:0,class:"q-mt-md"},{default:d(()=>[o(K,null,{default:d(()=>[l[6]||(l[6]=m("div",{class:"text-h6"},"AI Response",-1)),m("p",null,D(S.value),1)]),_:1})]),_:1})):H("",!0)])]),_:1})]),_:1}))}},Oe={class:"row"},Le={class:"col-4 category-side-panel"},Ne={class:"col-8 extraction-section"},Ee={class:"ai-query-section"},je={__name:"RagToolComponent",setup(U){const{error:s,fetchCurrentUser:p,fetchCategories:y,fetchSubCategories:f}=xe(),c=a([]),C=_=>{c.value=_};return J(async()=>{if(console.log("RagToolManagerPage mounted."),!await p()){alert("You must be signed in to Supabase to use this feature.");return}console.log("CategoryManagerPage mounted.")}),(_,v)=>(x(),I(E,{class:"ai-context-manager"},{default:d(()=>[m("div",Oe,[m("div",Le,[o(ie,{"onUpdate:selectedContexts":C})]),m("div",Ne,[o(ce),m("div",Ee,[o(ze,{"selected-contexts":c.value},null,8,["selected-contexts"])])])])]),_:1}))}},Be=X(je,[["__scopeId","data-v-72991f44"]]),Ge={class:"not-signed-in-container"},He={class:"not-signed-in-message"},Ke={__name:"NotSignedInComponent",setup(U){return(s,p)=>(x(),N("div",Ge,[m("div",He,[o(ae,{name:"warning",size:"md",color:"warning"}),p[0]||(p[0]=m("p",null,"You are not signed in. Please sign in to access this feature.",-1)),o(Y,{color:"primary",label:"Sign In",to:"/signin"})])]))}},Xe=X(Ke,[["__scopeId","data-v-d4bf718f"]]),Je={key:1,class:"rag-tool-content"},Ye={class:"main-content"},We={__name:"RagToolPage",setup(U){const{error:s,fetchCurrentUser:p,isUserSignedIn:y}=Z();return a(),J(async()=>{console.log("RagToolManagerPage mounted."),await p()}),(f,c)=>(x(),I(pe,{class:"rag-tool-page"},{default:d(()=>[fe(y)?(x(),N("div",Je,[o(ie),m("div",Ye,[o(ce),o(Be)])])):(x(),I(Xe,{key:0}))]),_:1}))}},ht=X(We,[["__scopeId","data-v-0b397ec2"]]);export{ht as default};
