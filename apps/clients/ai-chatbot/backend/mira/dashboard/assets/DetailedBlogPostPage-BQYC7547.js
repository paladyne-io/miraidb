import{o as Y,p as W,Q as y,e as X}from"./QBtn-D6I3yaUk.js";import{c as ee,h as te,a0 as Z,a3 as j,r as v,u as H,O as se,H as i,E as r,L as l,F as n,G as c,I as Q,N as f,a4 as m,M as b,$ as N,a as oe,w as ae,J as S,ah as le,_ as F}from"./main-pQ6I3G1N.js";import{Q as ne}from"./QImg-BMH2RUxh.js";import{a as ie,b as re,Q as D}from"./QItemSection-Dmpw6rM8.js";import{Q as ue}from"./QList-SZNIxzI5.js";import{Q as de}from"./QPage-D4d3kkw3.js";import{u as J}from"./postsStore-Dv2rteSz.js";import{B as me}from"./BlogPost-C0IYxXq2.js";import{Q as U}from"./QInput-DM8oeg_0.js";import{Q as G}from"./QCardSection-CPIT1auF.js";import{Q as O}from"./QCard-BZeChXVV.js";import{u as ce}from"./vue-i18n-C33Zb4Ep.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-timeout-BzxByfi4.js";import"./use-dark-S6zrulGz.js";import"./QCardActions-ByJiPUfy.js";import"./format-DyQxkAtJ.js";import"./use-id-C_AkVdpB.js";const pe='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',R=ee({name:"QSpinnerDots",props:Y,setup(w){const{cSize:_,classes:h}=W(w);return()=>te("svg",{class:h.value,fill:"currentColor",width:_.value,height:_.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:pe})}}),ve={key:0,class:"comment-text"},ge={key:1,class:"comment-text"},fe={class:"q-pt-md full-width"},_e={key:2,class:"row q-gutter-sm q-pt-lg"},ye={key:0},be={class:"row q-gutter-sm q-pt-md"},he={class:"col-7"},ke={class:"col-4"},we={class:"row q-gutter-sm q-pt-lg"},xe={key:1,class:"error-message"},Ce={__name:"NewCommentComponent",props:{post:{type:Object,required:!0}},emits:["commentAdded"],setup(w,{emit:_}){const h=Z(),g=_,{t:L}=ce(),{addComment:x,isUserSignedIn:A,getSignedInUserProfile:T}=j(),V=J(),C=v(""),e=v(""),u=v(""),p=v(""),k=A(),I=async()=>{if(!A)return"guest";const o=await T();return o?o.username:"anon"};H(async()=>{u.value=await I()});const P=async o=>{console.log("register here..."),h.push("signin")},q=async(o,t)=>{console.log("submitting comment...",o);const s=await x(o,t,u.value);s?(console.log("Added user comment: "+t),V.updatePostComments(o,s),e.value="",p.value="",g("commentAdded",s)):(p.value="Error adding user comment!",console.error(p.value))},E=async(o,t)=>{console.log("submitGuestComment: "+t);const s=await x(o,t,u.value||"guest");s?(console.log("Added guest comment: "+t),V.updatePostComments(o,s),e.value="",p.value="",g("commentAdded",s)):(p.value="Error adding guest comment",console.error(p.value))};function $(o){return/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/.test(o)}function B(){return L("type_email_address")}function M(o){const t=B();return!o||o.length===0?!0:$(o)||t}const z=()=>{const o=C.value.trim();return console.log("verifyEmail: "+o),console.log("Email OK: "+$(o)),$(o)};return(o,t)=>{const s=se("router-link");return i(),r(N,null,[l("div",null,[n(O,{class:"q-mt-md"},{default:c(()=>[n(G,null,{default:c(()=>[Q(k)?(i(),r("span",ve,[t[5]||(t[5]=f("Commenting as ")),n(s,{to:{name:"admin-profile"}},{default:c(()=>[f(m(u.value),1)]),_:1}),t[6]||(t[6]=f("."))])):(i(),r("span",ge,[t[8]||(t[8]=f("Commenting as a guest. ")),n(s,{class:"router-link",to:"/signin"},{default:c(()=>t[7]||(t[7]=[f(" Please sign in ")])),_:1})])),l("div",fe,[n(U,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value=a),type:"textarea",label:"Add a comment",filled:""},null,8,["modelValue"])]),Q(k)?(i(),r("div",_e,[n(y,{onClick:t[1]||(t[1]=a=>q(w.post.id,e.value)),label:"Post Comment",color:"primary",disabled:!e.value.trim()},null,8,["disabled"])])):b("",!0)]),_:1})]),_:1})]),Q(k)?b("",!0):(i(),r("div",ye,[n(O,{class:"q-mt-md"},{default:c(()=>[n(G,null,{default:c(()=>[t[9]||(t[9]=l("p",{class:"comment-text"},"Please enter your email to register or press the button below to comment as a guest. If you submit a comment without an email address your comment will be moderated and shown after it is approved. After registering, check your email for a verification link. If you sign in you can comment without this form.",-1)),l("div",be,[l("div",he,[n(U,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=a=>C.value=a),type:"email",ref:"emailAddress",rules:[a=>!!a||o.$t("enter_your_email_address"),M],autocomplete:"username",minlength:"6",maxlength:"50",outlined:"",label:o.$t("email"),hint:"Your email will not be displayed"},null,8,["modelValue","rules","label"])]),l("div",ke,[n(U,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value=a),type:"text",minlength:"2",maxlength:"20",outlined:"",label:o.$t("name"),hint:"The name that will be displayed next to your comment."},null,8,["modelValue","label"])])]),l("div",we,[n(y,{disabled:!z(),onClick:P,label:"Register",color:"secondary"},null,8,["disabled"]),n(y,{onClick:t[4]||(t[4]=a=>E(w.post.id,e.value)),label:"Comment as Guest",color:"primary"})])]),_:1})]),_:1})])),p.value?(i(),r("div",xe,m(p.value),1)):b("",!0)],64)}}},Pe=K(Ce,[["__scopeId","data-v-d41dbba5"]]),qe={key:0,class:"text-center q-mt-xl"},$e={key:1,class:"text-center text-negative q-mt-xl"},Qe={class:"post-container"},Ae={class:"post-header q-mb-xl hero-header"},Ve={class:"row justify-between q-mt-md"},Ie={class:"col-8"},Ee={class:"text-h3"},Se={class:"row post-meta q-gutter-x-md"},Ne={class:"text-grey-7"},Be={class:"text-primary"},Me={class:"text-grey-8"},ze={key:0,class:"col-4 self-end"},De={class:"text-right"},Ue={class:"post-content q-mb-xl"},Le={class:"text-body1 css-fix"},Te={class:"interaction-section q-mb-xl"},Fe={class:"row justify-between q-gutter-md"},Ge={class:"q-ml-sm text-body1"},Oe={key:0,class:"comments-section q-mt-lg"},Re={key:0,class:"text-center"},Ze={key:1,class:"text-subtitle1"},je={key:0,class:"related-posts q-mt-xl"},He={class:"row q-col-gutter-md"},Je={__name:"DetailedBlogPostPage",setup(w){const _=le(),h=Z(),g=J(),{user:L,formatDate:x,getComments:A,getTranslatedPostId:T,likePost:V,getPost:C}=j(),e=v(null),u=v([{}]),p=v(!1),k=v(null),I=v(!0),P=v(null),q=v(!0),E=oe(()=>!e.value||!g.posts?[]:g.posts.filter(s=>s.id===e.value.id?!1:s.category===e.value.category||s.author===e.value.author).slice(0,3)),$=async s=>{q.value=!0,u.value=await A(s),q.value=!1};function B(s){s&&(!u.value||u.value.length===0?u.value.unshift(s):u.value.push(s))}const M=async()=>{!e.value||e.value.liked||(await V(e.value.id),e.value.liked=!0,e.value.likes=(e.value.likes||0)+1)};async function z(){const s=e.value.id;console.log("Editing post with ID: "+s);const a=g.posts.find(d=>d.id===s);a&&a&&(console.log("Admin Pushing to dashboard-edit-post with id: "+s),h.push({name:"admin-edit-post",params:{id:s}}))}const o=async s=>{console.log("Opening post..."),h.push({name:"admin-view-post",params:{id:s}})},t=async s=>{if(console.log("Detailed blog post (re)loaded"),e.value=g.posts.find(a=>a.id===s),!e.value)try{e.value=await C(s)}catch{P.value="Failed to load post"}e.value&&(await $(e.value.id),k.value=await g.getImageForPost(e.value)),I.value=!1};return ae(()=>_.params.id,async s=>{t(s)}),H(async()=>{t(_.params.id)}),(s,a)=>(i(),S(de,{class:"detailed-blog-page q-pa-md"},{default:c(()=>[I.value?(i(),r("div",qe,[n(R,{color:"primary",size:"40px"})])):P.value?(i(),r("div",$e,m(P.value),1)):e.value?(i(),r(N,{key:2},[n(y,{flat:"",color:"primary",icon:"arrow_back",label:"Back to Blog",to:"/dashboard/admin-blog",class:"q-mb-md"}),l("div",Qe,[l("div",Ae,[l("div",Ve,[l("div",Ie,[l("h1",Ee,m(e.value.title),1),l("div",Se,[l("span",Ne,m(Q(x)(e.value.created_at)),1),l("span",Be,m(e.value.category||"Uncategorized"),1),l("span",Me,"by "+m(e.value.author||"Anonymous"),1)])]),e.value.translation_available&&e.value.linked_post_id?(i(),r("div",ze,[l("div",De,[n(y,{color:"secondary",label:"View Japanese Version",onClick:a[0]||(a[0]=d=>t(e.value.linked_post_id))})])])):b("",!0)])]),n(ne,{fit:"contain",src:k.value,ratio:16/9,class:"post-image q-mb-lg",onClick:a[1]||(a[1]=d=>o(e.value.id))},null,8,["src"]),l("div",Ue,[l("p",Le,m(e.value.content),1)]),l("div",Te,[l("div",Fe,[l("div",{class:"like-section row items-center cursor-pointer",onClick:M},[n(X,{name:"favorite",color:e.value.liked?"red":"grey",size:"24px"},null,8,["color"]),l("span",Ge,m(e.value.likes||0),1)]),n(y,{flat:"",round:"",color:"orange",icon:"edit",onClick:z}),n(y,{unelevated:"",color:"orange-8",icon:"comment",label:`Comments (${u.value.length})`,onClick:a[2]||(a[2]=d=>p.value=!p.value)},null,8,["label"])])]),p.value?(i(),r("div",Oe,[a[3]||(a[3]=l("h2",{class:"text-h5 q-mb-md"},"Comments",-1)),q.value?(i(),r("div",Re,[n(R,{color:"primary",size:"40px"})])):(i(),r("div",Ze,[n(ue,null,{default:c(()=>[(i(!0),r(N,null,F(u.value,d=>(i(),S(ie,{key:d.id},{default:c(()=>[n(re,null,{default:c(()=>[d.approved?(i(),S(D,{key:0},{default:c(()=>[f(m(d.username)+" : "+m(d.content),1)]),_:2},1024)):(i(),S(D,{key:1,class:"text-negative text-italic"},{default:c(()=>[f(m(d.username)+" : Comment awaiting approval",1)]),_:2},1024)),n(D,{caption:""},{default:c(()=>[f(m(Q(x)(d.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),n(Pe,{post:e.value,onCommentAdded:B},null,8,["post"])]))])):b("",!0)]),E.value.length>0?(i(),r("div",je,[a[4]||(a[4]=l("h2",{class:"text-h5 q-mb-lg"},"Related Posts",-1)),l("div",He,[(i(!0),r(N,null,F(E.value,d=>(i(),r("div",{key:d.id,class:"col-12 col-md-4 col-sm-6"},[n(me,{post:d,onViewPost:o},null,8,["post"])]))),128))])])):b("",!0)],64)):b("",!0)]),_:1}))}},vt=K(Je,[["__scopeId","data-v-0a955bdb"]]);export{vt as default};
