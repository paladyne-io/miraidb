const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-yJeh5-W9.css"])))=>i.map(i=>d[i]);
import{Q as z}from"./QCard-lY-ueOC8.js";import{Q as M}from"./option-sizes-C18sBPr-.js";import{a as ae,b as Z,Q as X}from"./use-id-Bvl0ZUaZ.js";import{Q as ce,a as ue,_ as de,b as pe}from"./RagToolComponent.vue_vue_type_style_index_0_scoped_af52c6ed_lang-K-c0l4-J.js";import{Q as oe}from"./QList-DrObr3Ar.js";import{e as me,Q as ee}from"./QBtn-DApSF4wg.js";import{Q as G}from"./QChip-BkMe-UX1.js";import{W as te,r as a,a as Q,u as J,J as w,L as $,I as d,H as l,N as p,G as K,U as se,S as ne,Q as R,X as D,O as H,_ as ve,Y as ge,Z as Y,$ as fe}from"./main--iDxh5Wg.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as le}from"./QInput-CRx6Vcav.js";import{Q as ye}from"./QExpansionItem-B0i2doLK.js";import{u as he}from"./useSupabaseCategoryManagement-qW4QH0MT.js";import"./use-dark-C2-dXCXf.js";import"./selection-BpTaXgJ1.js";import"./format-Da9rYVTl.js";const _e={class:"contexts-list q-pb-sm"},Ce={class:"row items-center full-width"},be={class:"col"},xe={key:0,class:"col-shrink"},we={__name:"RAGToolCategorySidePanel",emits:["update:selectedContexts"],setup(O,{emit:o}){const v=o,{fetchCategories:_,fetchSubCategories:f,fetchSavedContexts:u,SaveContextData:C}=te();a(""),a(""),a("");const y=a("");a(!1),a(null);const m=a([]),b=a([]),x=a(null),I=a(null),A=a([]),h=a([]),S=Q(()=>b.value.filter(c=>{var i;return c.category_id===((i=x.value)==null?void 0:i.id)})),F=c=>{const i=m.value.find(n=>n.id===c.category_id),e=b.value.find(n=>n.id===c.sub_category_id);return`${(i==null?void 0:i.name)||"Uncategorized"}${e?` - ${e.name}`:""}`},V=Q(()=>A.value.filter(c=>{const i=!x.value||c.category_id===x.value.id,e=!I.value||c.sub_category_id===I.value.id;return i&&e}));J(async()=>{try{m.value=await _(),b.value=await f(),A.value=await u()}catch(c){y.value=`Initialization error: ${c.message}`}});const k=()=>{I.value=null},N=c=>h.value.includes(c),L=c=>{const i=typeof c=="object"?c.id:c;h.value.includes(i)?h.value=h.value.filter(e=>e!==i):h.value.push(i),v("update:selectedContexts",h.value)},j=c=>{h.value=c,v("update:selectedContexts",c)},E=Q(()=>{const c={};return A.value.forEach(i=>{const e=m.value.find(r=>r.id===i.category_id),n=b.value.find(r=>r.id===i.sub_category_id);if(e){c[e.id]||(c[e.id]={id:e.id,label:e.name,type:"category",children:[]});let r=n?c[e.id].children.find(B=>B.id===n.id):null;n&&!r&&(r={id:n.id,label:n.name,type:"subcategory",children:[]},c[e.id].children.push(r));const T={id:i.id,label:i.original_url,type:"context",original_url:i.original_url};r?(r.children||(r.children=[]),r.children.push(T)):c[e.id].children.push(T)}}),Object.values(c)});return(c,i)=>(w(),$(z,null,{default:d(()=>[l(G,null,{default:d(()=>[i[3]||(i[3]=p("div",{class:"text-h6"},"Categories",-1)),l(M,{class:"q-mb-md",modelValue:x.value,"onUpdate:modelValue":[i[0]||(i[0]=e=>x.value=e),k],options:m.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),l(M,{class:"q-mb-md",modelValue:I.value,"onUpdate:modelValue":i[1]||(i[1]=e=>I.value=e),options:S.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!x.value,outlined:"",dense:""},null,8,["modelValue","options","disable"]),p("div",_e,[i[2]||(i[2]=p("div",{class:"text-h6"},"Saved Contexts",-1)),l(oe,{bordered:"",separator:""},{default:d(()=>[(w(!0),K(se,null,ne(V.value,e=>(w(),$(ae,{key:e.id,clickable:"",onClick:n=>L(e)},{default:d(()=>[l(Z,null,{default:d(()=>[l(X,null,{default:d(()=>[R(D(e.original_url),1)]),_:2},1024),l(X,{caption:""},{default:d(()=>[R(D(F(e)),1)]),_:2},1024)]),_:2},1024),l(Z,{side:""},{default:d(()=>[l(ce,{"model-value":N(e.id),"onUpdate:modelValue":n=>L(e)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),l(ue,{nodes:E.value,"node-key":"id","label-key":"label","children-key":"children","default-expand-all":"","tick-strategy":"leaf",ticked:h.value,"onUpdate:ticked":j,class:"contexts-tree q-mt-md"},{"default-header":d(e=>[p("div",Ce,[p("div",be,D(e.node.label),1),e.node.type==="context"?(w(),K("div",xe,[l(me,{name:"link",title:e.node.original_url,class:"q-ml-xs"},null,8,["title"])])):H("",!0)])]),_:1},8,["nodes","ticked"])]),_:1})]),_:1}))}},Se=W(we,[["__scopeId","data-v-10a97c3d"]]);class Te{static async processPDF(o){try{const v=await o.arrayBuffer(),_=await de(v).promise;let f="";for(let u=1;u<=_.numPages;u++){const m=(await(await _.getPage(u)).getTextContent()).items.map(b=>b.str).join(" ");f+=m+`
`}return{text:f.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}}}catch(v){throw console.error("PDF processing error:",v),new Error("Failed to process PDF file")}}static async processTextFile(o){return new Promise((v,_)=>{const f=new FileReader;f.onload=u=>{var y;const C=(y=u.target)==null?void 0:y.result;v({text:C.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=_,f.readAsText(o)})}static async processHTMLFile(o){return new Promise((v,_)=>{const f=new FileReader;f.onload=u=>{var b;const C=(b=u.target)==null?void 0:b.result,y=document.createElement("div");y.innerHTML=C;const m=y.textContent||y.innerText;v({text:m.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=_,f.readAsText(o)})}static async processRTFFile(o){return new Promise((v,_)=>{const f=new FileReader;f.onload=u=>{var m;const y=((m=u.target)==null?void 0:m.result).replace(/\\[a-z]{1,32}(-)?|\{|\}|\\\n?/gm,"").replace(/[\\{}]/g,"").replace(/[\r\n]+/g," ");v({text:y.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=_,f.readAsText(o)})}static async processDOCXFile(o){try{const v=await ve(()=>import("./index-ChYy5NGk.js").then(u=>u.i),__vite__mapDeps([0])),_=await o.arrayBuffer();return{text:(await v.extractRawText({arrayBuffer:_})).value.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}}}catch(v){throw console.error("DOCX processing error:",v),new Error("Failed to process DOCX file")}}static async processFile(o){const _={"application/pdf":this.processPDF,"text/plain":this.processTextFile,"text/html":this.processHTMLFile,"text/rtf":this.processRTFFile,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":this.processDOCXFile}[o.type];if(_)return await _(o);throw new Error(`Unsupported file type: ${o.type}`)}}const Pe={class:"file-upload-section"},Ie={class:"row items-center url-input-section q-mb-md"},Fe={class:"col-8"},$e={class:"col"},Ae={class:"file-input-section q-mb-md"},Ve={class:"category-selection"},ke={class:"q-pt-md"},Re={__name:"RAGToolAIContextManager",setup(O){const{fetchCategories:o,fetchSubCategories:v,fetchSavedContexts:_,SaveContextData:f}=te();a("");const u=a("test"),C=a(""),y=a(""),m=a(""),b=a(!1),x=a(null),I=a([]),A=a([]),h=a(null),S=a(null),F=a([]);a([{}]);const V=Q(()=>C.value&&h.value);J(async()=>{try{I.value=await o(),A.value=await v(),F.value=await _()}catch(s){m.value=`Initialization error: ${s.message}`}});const k=Q(()=>A.value.filter(s=>{var t;return s.category_id===((t=h.value)==null?void 0:t.id)}));Q(()=>F.value.filter(s=>{const t=!h.value||s.category_id===h.value.id,g=!S.value||s.sub_category_id===S.value.id;return t&&g}));const N=()=>{S.value=null},L=()=>{C.value="",u.value="",S.value=null,x.value&&(x.value.value="")},j=(s,t=500)=>s.length>t?s.substring(0,t)+"...":s,E=s=>{s.preventDefault(),b.value=!0},c=()=>{b.value=!1},i=async s=>{if(b.value=!1,s.preventDefault(),console.log("handleDrop.. "),s.dataTransfer.files.length>0){const g=s.dataTransfer.files[0];if(console.log("Processing a dropped file.. ",g),console.log("file type:",g.type),!g.name.endsWith(".webloc"))try{await n(g)}catch(P){console.error("File drop processing error:",P),m.value=P.message}return}const t=s.dataTransfer.getData("text/plain");t&&(console.log("droppedUrl: ",t),u.value=t,r())},e=async s=>{const t=s.target.files[0];t&&await n(t)},n=async s=>{try{const t=await Te.processFile(s);C.value=t.text,m.value=""}catch(t){m.value=`File processing error: ${t.message}`}},r=async()=>{if(!u.value){m.value="Please enter a valid URL";return}try{const t=await(await fetch(u.value)).text(),P=new DOMParser().parseFromString(t,"text/html"),q=T(P).join(`

`);y.value=B(q),C.value=y,m.value=""}catch(s){m.value=`URL extraction error: ${s.message}`}},T=s=>{const t=[()=>{const g=["main","article",".main-content","#main-content",".content","#content"];for(let P of g){const U=s.querySelector(P);if(U)return Array.from(U.querySelectorAll("p, h1, h2, h3, h4, h5, h6")).map(q=>q.textContent.trim()).filter(q=>q.length>0)}return[]},()=>Array.from(s.querySelectorAll("p")).map(g=>g.textContent.trim()).filter(g=>g.length>0)];for(let g of t){const P=g();return P.length>0?P:[]}},B=s=>{if(!s||s.length===0)return"No content could be extracted.";const t=s.split(`

`);if(t.length<=3)return s;const g=[],P=["summary","key points","main idea","important","conclusion","highlights","overview"];return t.forEach(U=>{const q=U.toLowerCase();(P.some(ie=>q.includes(ie))||U.length>100)&&g.push(U)}),g.length===0&&g.push(...t.slice(0,3)),g.join(`

`)},re=async()=>{var s;if(!V.value){m.value="Please select a category and provide content";return}try{const t=await f(u.value||"Uploaded Content",C.value,C.value.length/1e3,h.value.id,(s=S.value)==null?void 0:s.id);F.value.push(t),L()}catch(t){m.value=`Save as context error: ${t.message}`}};return(s,t)=>(w(),$(z,{class:"col-8 extraction-section"},{default:d(()=>[l(G,null,{default:d(()=>[t[6]||(t[6]=p("h5",null,"Extract and Manage AI Context",-1)),p("div",Pe,[p("div",{class:ge(["drop-zone",{"drag-active":b.value}]),onDragover:Y(E,["prevent"]),onDragleave:Y(c,["prevent"]),onDrop:Y(i,["prevent"])},t[3]||(t[3]=[p("p",null,"Drag and Drop a URL (web link) or file Here",-1)]),34),p("div",Ie,[p("div",Fe,[l(le,{class:"col q-ma-sm",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=g=>u.value=g),placeholder:"Enter URL to extract text",onKeyup:fe(r,["enter"])},null,8,["modelValue"])]),p("div",$e,[l(ee,{class:"q-ma-sm",onClick:r,disabled:!u.value,color:"primary"},{default:d(()=>t[4]||(t[4]=[R(" Extract URL Text ")])),_:1},8,["disabled"])])]),p("div",Ae,[p("input",{type:"file",ref_key:"fileInput",ref:x,onChange:e,accept:".pdf,.txt,.html,.rtf,.docx,.md"},null,544)]),m.value?(w(),$(pe,{key:0,class:"bg-negative text-white q-mb-md"},{default:d(()=>[R(D(m.value),1)]),_:1})):H("",!0),C.value?(w(),$(ye,{key:1,label:"Extracted Content Preview","default-opened":"",class:"q-mb-md"},{default:d(()=>[l(z,null,{default:d(()=>[l(G,null,{default:d(()=>[p("div",null,D(j(C.value)),1)]),_:1})]),_:1})]),_:1})):H("",!0)]),p("div",Ve,[l(M,{modelValue:h.value,"onUpdate:modelValue":[t[1]||(t[1]=g=>h.value=g),N],options:I.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),l(M,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=g=>S.value=g),options:k.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!h.value,outlined:"",dense:""},null,8,["modelValue","options","disable"])]),p("div",ke,[l(ee,{onClick:re,color:"positive",disable:!V.value,class:"q-mb-md"},{default:d(()=>t[5]||(t[5]=[R(" Save Context ")])),_:1},8,["disable"])])]),_:1})]),_:1}))}},De=W(Re,[["__scopeId","data-v-3e638f7f"]]),Ue={key:0,class:"selected-contexts q-mb-md"},qe={class:"ai-query-section"},Me={__name:"RAGToolAIInteractionComponent",props:{selectedContexts:{type:Array,default:()=>[]}},setup(O){const o=O,{fetchCategories:v,fetchSubCategories:_,fetchSavedContexts:f}=te(),u=a(""),C=a([]),y=a([]),m=a([]),b=a(""),x=a("openai"),I=["openai","anthropic"],A=a("gpt-4o-mini"),h=a(["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"]),S=a(null),F=a(null),V=a(["Combine in Prompt"]),k=a("Combine in Prompt");new AbortController;const N="https://virtag-ai.fly.dev";J(async()=>{try{C.value=await v(),y.value=await _(),m.value=await f()}catch(e){u.value=`Initialization error: ${e.message}`}});const L=()=>{console.log("updateAIServiceOptions: "+x.value),x.value==="openai"?(h.value=["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"],V.value=["Combine in Prompt","Upload as Files"],k.value="Combine in Prompt"):x.value==="anthropic"&&(h.value=["claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-opus-20240229"],V.value=["Combine in Prompt"],k.value="Combine in Prompt"),console.log("contextProcessingOptions: "+V.value)},j=()=>V.value,E=Q(()=>m.value.filter(e=>o.selectedContexts.includes(e.id))),c=e=>{const n=C.value.find(T=>T.id===e.category_id),r=y.value.find(T=>T.id===e.sub_category_id);return`${(n==null?void 0:n.name)||"Uncategorized"}${r?` - ${r.name}`:""}`},i=async()=>{try{const e=`${N}/api/openai`;if(!F.value){const B=await(await fetch(`${e}/createThread`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();F.value=B.id}const n=await fetch(`${e}/addMessageToThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:F.value,content:b.value})}),r=await fetch(`${e}/runThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:F.value,assistantId:"your_assistant_id"})});S.value=await r.json().then(T=>T.response)}catch(e){e.name==="AbortError"?u.value="Request was canceled":u.value=`AI query error: ${e.message}`,console.error(e)}};return(e,n)=>(w(),$(z,{class:"col-8 extraction-section"},{default:d(()=>[l(G,null,{default:d(()=>[E.value.length>0?(w(),K("div",Ue,[n[4]||(n[4]=p("div",{class:"text-h6"},"Selected Contexts",-1)),l(oe,{bordered:"",separator:""},{default:d(()=>[(w(!0),K(se,null,ne(E.value,r=>(w(),$(ae,{key:r.id},{default:d(()=>[l(Z,null,{default:d(()=>[l(X,null,{default:d(()=>[R(D(r.original_url),1)]),_:2},1024),l(X,{caption:""},{default:d(()=>[R(D(c(r)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):H("",!0),p("div",qe,[l(M,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=r=>k.value=r),options:j(),label:"Context Processing Method",class:"q-mb-md"},null,8,["modelValue","options"]),l(le,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=r=>b.value=r),label:"AI Query",outlined:"",type:"textarea",class:"q-mb-md"},null,8,["modelValue"]),l(M,{modelValue:x.value,"onUpdate:modelValue":[n[2]||(n[2]=r=>x.value=r),L],options:I,label:"AI Service",class:"q-mb-md"},null,8,["modelValue"]),l(M,{modelValue:A.value,"onUpdate:modelValue":n[3]||(n[3]=r=>A.value=r),options:h.value,label:"AI Model",class:"q-mb-md"},null,8,["modelValue","options"]),l(ee,{onClick:i,color:"primary",disable:!b.value},{default:d(()=>n[5]||(n[5]=[R(" Send to AI ")])),_:1},8,["disable"]),S.value?(w(),$(z,{key:0,class:"q-mt-md"},{default:d(()=>[l(G,null,{default:d(()=>[n[6]||(n[6]=p("div",{class:"text-h6"},"AI Response",-1)),p("p",null,D(S.value),1)]),_:1})]),_:1})):H("",!0)])]),_:1})]),_:1}))}},Qe={class:"row"},ze={class:"col-4 category-side-panel"},Oe={class:"col-8 extraction-section"},Le={class:"ai-query-section"},Ee={__name:"RagToolComponent",setup(O){const{error:o,fetchCurrentUser:v,fetchCategories:_,fetchSubCategories:f}=he(),u=a([]),C=y=>{u.value=y};return J(async()=>{if(console.log("RagToolManagerPage mounted."),!await v()){alert("You must be signed in to use this feature.");return}console.log("CategoryManagerPage mounted.")}),(y,m)=>(w(),$(z,{class:"ai-context-manager"},{default:d(()=>[p("div",Qe,[p("div",ze,[l(Se,{"onUpdate:selectedContexts":C})]),p("div",Oe,[l(De),p("div",Le,[l(Me,{"selected-contexts":u.value},null,8,["selected-contexts"])])])])]),_:1}))}},Ne=W(Ee,[["__scopeId","data-v-af52c6ed"]]),je={class:"container"},Be={class:"q-pa-lg"},Ge={__name:"RagToolPage",setup(O){return(o,v)=>(w(),$(z,{class:"card-container"},{default:d(()=>[p("div",je,[v[0]||(v[0]=p("h1",{class:"page-title"},"RAG tool",-1)),p("div",Be,[l(Ne)])])]),_:1}))}},ct=W(Ge,[["__scopeId","data-v-feb5edee"]]);export{ct as default};
