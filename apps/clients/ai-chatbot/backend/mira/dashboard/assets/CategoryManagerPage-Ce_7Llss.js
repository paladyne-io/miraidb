import{Q as F}from"./QBtn-17rgya3j.js";import{Q as se}from"./QCard-B3DssZPe.js";import{r as C,C as V,u as oe,L as A,I as x,J as u,N as t,O as S,x as p,ad as m,H as E,Q as M,G as g,a0 as q,a1 as P,a4 as k}from"./main-s4YKoVr5.js";import{u as ne}from"./useSupabaseCategoryManagement-CKGaNoCU.js";import{N as ie}from"./NotSignedInComponent-CKW6K0jI.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-8fmQ0m1E.js";const v=i=>i.replace(/<[^>]*>/g,"").trim(),Q=i=>{const n=[];return i.name?i.name.length<2?n.push("Category name must be at least 2 characters long"):i.name.length>50&&n.push("Category name cannot exceed 50 characters"):n.push("Category name is required"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},le=i=>{const n=[];return i.name?i.name.length<2?n.push("Subcategory name must be at least 2 characters long"):i.name.length>50&&n.push("Subcategory name cannot exceed 50 characters"):n.push("Subcategory name is required"),i.categoryId||n.push("A parent category must be selected"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},ce={class:"container"},de={class:"category-section"},ue={class:"add-category-card"},pe={class:"input-group"},me={class:"categories-grid"},ge={class:"category-header"},ye={class:"category-actions"},ve=["onClick"],fe=["onClick"],Ce={class:"category-description"},be={class:"subcategory-section"},he={class:"add-subcategory-form"},_e={key:0,class:"input-group"},Se=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],De={class:"subcategories-list"},we={class:"subcategory-content"},Ve={class:"subcategory-name"},xe={class:"subcategory-actions"},Ne=["onClick"],Ue=["onClick"],Be={class:"subcategory-description"},Ie={key:0,class:"modal"},ze={class:"modal-content"},Fe={key:1,class:"modal"},Ae={class:"modal-content"},Ee={__name:"CategoryManagerPage",setup(i){const{error:n,isUserSignedIn:Me,fetchCurrentUser:$,fetchCategories:b,fetchSubCategories:D,addCategory:T,updateCategory:j,deleteCategory:L,addSubcategory:O,deleteSubcategory:G,updateSubcategory:H}=ne(),N=C(),y=C([]),h=C([]),d=V({name:"",description:""});V({});const r=C(null),l=C(null),c=V({}),J=()=>{y.value.forEach(s=>{s.id in c||(c[s.id]={name:"",description:""})})},K=async()=>{const s=v(d.name),e=d.description?v(d.description):"",{isValid:a,errors:o}=Q({name:s,description:e});if(!a){alert(o.join(`
`));return}await T(d.name,d.description)?(console.error("Add category success."),d.name="",d.description="",y.value=await b(),alert("The new category was added successfully.")):alert("Failed to add category.")},R=async s=>{if(!confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))return;await L(s)?(console.error("Delete category success."),y.value=await b()):alert("Failed to delete category.")},W=s=>{r.value={...s}},U=async()=>{var _,w,I,z;if(!((_=r.value)!=null&&_.name.trim())){alert("Category name is required");return}const s=v((w=r.value)==null?void 0:w.name),e=(I=r.value)!=null&&I.description?v((z=r.value)==null?void 0:z.description):"",{isValid:a,errors:o}=Q({name:s,description:e});if(!a){alert(o.join(`
`));return}await j(r.value.id,r.value.name,r.value.description)?(console.error("Update category success."),r.value=null,y.value=await b()):alert("Failed to update category.")},B=()=>{r.value=null},X=async s=>{console.log("addSubcategoryInDB categoryId: "+s),c[s]||(c[s]={name:"",description:""});const e=c[s],a=v(e.name),o=e.description?v(e.description):"",{isValid:f,errors:_}=le({name:a,description:o,categoryId:s});if(!f){alert(_.join(`
`));return}if(!e.name||!e.name.trim()){alert("Subcategory name is required");return}await O(s,e.name,e.description)?(console.log("Added subcategory."),c[s].name="",c[s].description="",h.value=await D()):alert("Failed to add subcategory.")},Y=async s=>{if(!confirm("Are you sure you want to delete this subcategory?"))return;await G(s)?(console.error("Delete subcategory success."),h.value=await D()):alert("Failed to delete subcategory.")},Z=s=>{l.value={...s}},ee=async()=>{var e;if(!((e=l.value)!=null&&e.name.trim())){alert("Subcategory name is required");return}await H(l.value.id,l.value.name,l.value.description)?(console.error("Update subcategory success."),l.value=null):alert("Failed to update subcategory.")},te=()=>{l.value=null},ae=async()=>{const s=await b();y.value=s||[];const e=await D();h.value=e||[],J()};return oe(async()=>{console.log("CategoryManagerPage mounted."),N.value=await $(),console.log("CategoryManagerPage mounted. Fetching categories..."),ae()}),(s,e)=>(u(),A(se,{class:"category-management"},{default:x(()=>[t("div",ce,[e[13]||(e[13]=t("h2",{class:"page-title"},"Category Management",-1)),N.value?S("",!0):(u(),A(ie,{key:0})),t("div",de,[t("div",ue,[e[7]||(e[7]=t("h3",{class:"category-title q-pb-md"},"Create a New Category",-1)),t("div",pe,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.name=a),placeholder:"Category Name",type:"text",class:"form-input"},null,512),[[m,d.name]]),p(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.description=a),placeholder:"Category Description (Optional)",class:"form-textarea"},null,512),[[m,d.description]]),E(F,{onClick:K,class:"btn-primary"},{default:x(()=>e[6]||(e[6]=[t("i",{class:"fas fa-plus"},null,-1),M(" Add Category ")])),_:1}),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:B},"Cancel")])])]),t("div",me,[(u(!0),g(P,null,q(y.value,a=>(u(),g("div",{key:a.id,class:"category-card"},[t("div",ge,[t("h3",null,k(a.name),1),t("div",ye,[t("button",{onClick:o=>W(a),class:"btn-edit"},e[8]||(e[8]=[t("i",{class:"fas fa-edit"},null,-1)]),8,ve),t("button",{onClick:o=>R(a.id),class:"btn-delete"},e[9]||(e[9]=[t("i",{class:"fas fa-trash"},null,-1)]),8,fe)])]),t("p",Ce,k(a.description||"No description"),1),t("div",be,[t("div",he,[c[a.id]?(u(),g("div",_e,[p(t("input",{"onUpdate:modelValue":o=>c[a.id].name=o,placeholder:"Subcategory Name",class:"form-input"},null,8,Se),[[m,c[a.id].name]]),p(t("textarea",{"onUpdate:modelValue":o=>c[a.id].description=o,placeholder:"Subcategory Description",class:"form-textarea"},null,8,ke),[[m,c[a.id].description]]),E(F,{onClick:o=>X(a.id),class:"btn-secondary"},{default:x(()=>e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),M(" Add Subcategory ")])),_:2},1032,["onClick"])])):S("",!0)]),t("div",De,[(u(!0),g(P,null,q(h.value.filter(o=>o.category_id===a.id),o=>(u(),g("div",{key:o.id,class:"subcategory-item"},[t("div",we,[t("span",Ve,k(o.name),1),t("div",xe,[t("button",{onClick:f=>Z(o),class:"btn-edit-small"},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ne),t("button",{onClick:f=>Y(o.id),class:"btn-delete-small"},e[12]||(e[12]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Ue)])]),t("p",Be,k(o.description||"No description"),1)]))),128))])])]))),128))])])]),r.value?(u(),g("div",Ie,[t("div",ze,[e[14]||(e[14]=t("h2",null,"Edit Category",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"Category Name"},null,512),[[m,r.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.description=a),placeholder:"Category Description"},null,512),[[m,r.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:B},"Cancel")])])])):S("",!0),l.value?(u(),g("div",Fe,[t("div",Ae,[e[15]||(e[15]=t("h2",null,"Edit Subcategory",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.name=a),placeholder:"Subcategory Name"},null,512),[[m,l.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),placeholder:"Subcategory Description"},null,512),[[m,l.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:ee},"Save"),t("button",{onClick:te},"Cancel")])])])):S("",!0)]),_:1}))}},Oe=re(Ee,[["__scopeId","data-v-af44ffb5"]]);export{Oe as default};
