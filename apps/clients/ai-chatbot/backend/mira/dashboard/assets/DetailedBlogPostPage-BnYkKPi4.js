import{Q as j}from"./QSpinnerDots-Cg36toTM.js";import{Q as y,a as Y}from"./QBtn-Dfw2kp-I.js";import{Q as H}from"./QImg-H2fJ4B8o.js";import{a as W,Q as X,b as D}from"./QItemSection-aE-WNMmb.js";import{Q as ee}from"./QList-ApFJAUNp.js";import{Q as te}from"./QPage-D40g0nkh.js";import{u as G,v as se,l as v,o as O,r as oe,e as i,c as r,d as o,b as l,n as m,a as C,q as p,t as d,s as _,F as B,j as ae,k as le,w as ne,m as I,x as F}from"./mainRouter-D1MtaxKQ.js";import{u as M,B as ie}from"./BlogPost-B5OJKD2D.js";import{u as J}from"./useSupabase-C9RX7rG1.js";import{Q as N}from"./QInput-WPBEwenM.js";import{Q as R}from"./QCardSection-CYgasTQA.js";import{Q as Z}from"./QCard-DSFwVwpM.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-timeout-CR3r1ZoW.js";import"./use-dark-0IRRmxwP.js";import"./QChip-B5fAKKlQ.js";import"./QCardActions-dUHmP9GC.js";import"./date-C7HqJixX.js";import"./format-DyQxkAtJ.js";import"./use-id-DMSnSmkA.js";import"./private.use-form-D5cE26cE.js";const re={key:0,class:"comment-text"},ue={key:1,class:"comment-text"},de={class:"q-pt-md full-width"},me={key:2,class:"row q-gutter-sm q-pt-lg"},ce={key:0},ve={class:"row q-gutter-sm q-pt-md"},pe={class:"col-7"},ge={class:"col-4"},_e={class:"row q-gutter-sm q-pt-lg"},fe={key:1,class:"error-message"},ye={__name:"NewCommentComponent",props:{post:{type:Object,required:!0}},emits:["commentAdded"],setup(E,{emit:q}){const S=G(),g=q,{t:L}=se(),{addComment:b,isUserSignedIn:P,getSignedInUserProfile:T}=J(),$=M(),h=v(""),t=v(""),u=v(""),c=v(""),f=P(),Q=async()=>{if(!P)return"guest";const s=await T();return s?s.username:"anon"};O(async()=>{u.value=await Q()});const k=async s=>{console.log("register here..."),S.push("signin")},x=async(s,e)=>{console.log("submitting comment...",s);const a=await b(s,e,u.value);a?(console.log("Added user comment: "+e),$.updatePostComments(s,a),t.value="",c.value="",g("commentAdded",a)):(c.value="Error adding user comment!",console.error(c.value))},V=async(s,e)=>{console.log("submitGuestComment: "+e);const a=await b(s,e,u.value||"guest");a?(console.log("Added guest comment: "+e),$.updatePostComments(s,a),t.value="",c.value="",g("commentAdded",a)):(c.value="Error adding guest comment",console.error(c.value))};function w(s){return/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/.test(s)}function z(){return L("type_email_address")}function U(s){const e=z();return!s||s.length===0?!0:w(s)||e}const A=()=>{const s=h.value.trim();return console.log("verifyEmail: "+s),console.log("Email OK: "+w(s)),w(s)};return(s,e)=>{const a=oe("router-link");return i(),r(B,null,[o("div",null,[l(Z,{class:"q-mt-md"},{default:m(()=>[l(R,null,{default:m(()=>[C(f)?(i(),r("span",re,[e[5]||(e[5]=p("Commenting as ")),l(a,{to:{name:"profile"}},{default:m(()=>[p(d(u.value),1)]),_:1}),e[6]||(e[6]=p("."))])):(i(),r("span",ue,[e[8]||(e[8]=p("Commenting as a guest. ")),l(a,{to:"/signin"},{default:m(()=>e[7]||(e[7]=[p("Please sign in ")])),_:1})])),o("div",de,[l(N,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value=n),type:"textarea",label:"Add a comment",filled:""},null,8,["modelValue"])]),C(f)?(i(),r("div",me,[l(y,{onClick:e[1]||(e[1]=n=>x(E.post.id,t.value)),label:"Post Comment",color:"primary",disabled:!t.value.trim()},null,8,["disabled"])])):_("",!0)]),_:1})]),_:1})]),C(f)?_("",!0):(i(),r("div",ce,[l(Z,{class:"q-mt-md"},{default:m(()=>[l(R,null,{default:m(()=>[e[9]||(e[9]=o("p",{class:"comment-text"},"Please enter your email to register or press the button below to comment as a guest. If you submit a comment without an email address your comment will be moderated and shown after it is approved. After registering, check your email for a verification link. If you sign in you can comment without this form.",-1)),o("div",ve,[o("div",pe,[l(N,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=n=>h.value=n),type:"email",ref:"emailAddress",rules:[n=>!!n||s.$t("enter_your_email_address"),U],autocomplete:"username",minlength:"6",maxlength:"50",outlined:"",label:s.$t("email"),hint:"Your email will not be displayed"},null,8,["modelValue","rules","label"])]),o("div",ge,[l(N,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value=n),type:"text",minlength:"2",maxlength:"20",outlined:"",label:s.$t("name"),hint:"The name that will be displayed next to your comment."},null,8,["modelValue","label"])])]),o("div",_e,[l(y,{disabled:!A(),onClick:k,label:"Register",color:"secondary"},null,8,["disabled"]),l(y,{onClick:e[4]||(e[4]=n=>V(E.post.id,t.value)),label:"Comment as Guest",color:"primary"})])]),_:1})]),_:1})])),c.value?(i(),r("div",fe,d(c.value),1)):_("",!0)],64)}}},be=K(ye,[["__scopeId","data-v-0a421e39"]]),he={key:0,class:"text-center q-mt-xl"},ke={key:1,class:"text-center text-negative q-mt-xl"},xe={class:"post-container"},we={class:"post-header q-mb-xl hero-header"},Ce={class:"row justify-between q-mt-md"},qe={class:"col-8"},Pe={class:"text-h3"},$e={class:"row post-meta q-gutter-x-md"},Qe={class:"text-grey-7"},Ve={class:"text-primary"},Ae={class:"text-grey-8"},Ie={key:0,class:"col-4 self-end"},Be={class:"text-right"},Ee={class:"post-content q-mb-xl"},Se={class:"text-body1 css-fix"},ze={class:"interaction-section q-mb-xl"},Ue={class:"row justify-between q-gutter-md"},De={class:"q-ml-sm text-body1"},Ne={key:0,class:"comments-section q-mt-lg"},Le={key:0,class:"text-center"},Te={key:1,class:"text-subtitle1"},je={key:0,class:"related-posts q-mt-xl"},Fe={class:"row q-col-gutter-md"},Re={__name:"DetailedBlogPostPage",setup(E){const q=ae(),S=G(),g=M(),{user:L,formatDate:b,getComments:P,getTranslatedPostId:T,likePost:$,getPost:h}=J(),t=v(null),u=v([{}]),c=v(!1),f=v(null),Q=v(!0),k=v(null),x=v(!0),V=le(()=>!t.value||!g.posts?[]:g.posts.filter(e=>e.id===t.value.id?!1:e.category===t.value.category||e.author===t.value.author).slice(0,3)),w=async e=>{x.value=!0,u.value=await P(e),x.value=!1};function z(e){e&&(!u.value||u.value.length===0?u.value.unshift(e):u.value.push(e))}const U=async()=>{!t.value||t.value.liked||(await $(t.value.id),t.value.liked=!0,t.value.likes=(t.value.likes||0)+1)},A=async e=>{console.log("Opening post..."),S.push({name:"view-post",params:{id:e}})},s=async e=>{if(console.log("Detailed blog post (re)loaded"),t.value=g.posts.find(a=>a.id===e),!t.value)try{t.value=await h(e)}catch{k.value="Failed to load post"}t.value&&(await w(t.value.id),f.value=await g.getImageForPost(t.value)),Q.value=!1};return ne(()=>q.params.id,async e=>{s(e)}),O(async()=>{s(q.params.id)}),(e,a)=>(i(),I(te,{class:"detailed-blog-page q-pa-md"},{default:m(()=>[Q.value?(i(),r("div",he,[l(j,{color:"primary",size:"40px"})])):k.value?(i(),r("div",ke,d(k.value),1)):t.value?(i(),r(B,{key:2},[l(y,{flat:"",color:"primary",icon:"arrow_back",label:"Back to Blog",to:"/blog",class:"q-mb-md"}),o("div",xe,[o("div",we,[o("div",Ce,[o("div",qe,[o("h1",Pe,d(t.value.title),1),o("div",$e,[o("span",Qe,d(C(b)(t.value.created_at)),1),o("span",Ve,d(t.value.category||"Uncategorized"),1),o("span",Ae,"by "+d(t.value.author||"Anonymous"),1)])]),t.value.translation_available&&t.value.linked_post_id?(i(),r("div",Ie,[o("div",Be,[p(" linked_post_id"+d(t.value.linked_post_id)+" ",1),l(y,{color:"secondary",label:"View Japanese Version",onClick:a[0]||(a[0]=n=>s(t.value.linked_post_id))})])])):_("",!0)])]),l(H,{fit:"contain",src:f.value,ratio:16/9,class:"post-image q-mb-lg",onClick:a[1]||(a[1]=n=>A(t.value.id))},null,8,["src"]),o("div",Ee,[o("p",Se,d(t.value.content),1)]),o("div",ze,[o("div",Ue,[o("div",{class:"like-section row items-center cursor-pointer",onClick:U},[l(Y,{name:"favorite",color:t.value.liked?"red":"grey",size:"24px"},null,8,["color"]),o("span",De,d(t.value.likes||0),1)]),l(y,{unelevated:"",color:"orange-8",icon:"comment",label:`Comments (${u.value.length})`,onClick:a[2]||(a[2]=n=>c.value=!c.value)},null,8,["label"])])]),c.value?(i(),r("div",Ne,[a[3]||(a[3]=o("h2",{class:"text-h5 q-mb-md"},"Comments",-1)),x.value?(i(),r("div",Le,[l(j,{color:"primary",size:"40px"})])):(i(),r("div",Te,[l(ee,null,{default:m(()=>[(i(!0),r(B,null,F(u.value,n=>(i(),I(W,{key:n.id},{default:m(()=>[l(X,null,{default:m(()=>[n.approved?(i(),I(D,{key:0},{default:m(()=>[p(d(n.username)+" : "+d(n.content),1)]),_:2},1024)):(i(),I(D,{key:1,class:"text-negative text-italic"},{default:m(()=>[p(d(n.username)+" : Comment awaiting approval",1)]),_:2},1024)),l(D,{caption:""},{default:m(()=>[p(d(C(b)(n.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(be,{post:t.value,onCommentAdded:z},null,8,["post"])]))])):_("",!0)]),V.value.length>0?(i(),r("div",je,[a[4]||(a[4]=o("h2",{class:"text-h5 q-mb-lg"},"Related Posts",-1)),o("div",Fe,[(i(!0),r(B,null,F(V.value,n=>(i(),r("div",{key:n.id,class:"col-12 col-md-4 col-sm-6"},[l(ie,{post:n,onViewPost:A},null,8,["post"])]))),128))])])):_("",!0)],64)):_("",!0)]),_:1}))}},mt=K(Re,[["__scopeId","data-v-9cc01cf0"]]);export{mt as default};
