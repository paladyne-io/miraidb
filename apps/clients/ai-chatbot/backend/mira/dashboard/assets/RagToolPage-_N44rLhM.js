const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-yJeh5-W9.css"])))=>i.map(i=>d[i]);
import{Q as ce}from"./QPage-g26CNI1h.js";import{N as ue}from"./NotSignedInComponent-CKW6K0jI.js";import{Q as M}from"./option-sizes-B8GINB-T.js";import{a as ae,b as ee,Q as J}from"./QItemSection-Bjr3vCmi.js";import{Q as de,a as pe,_ as me}from"./RagToolComponent.vue_vue_type_style_index_0_scoped_8ce014a3_lang-B0RJO_5w.js";import{Q as oe}from"./QList-CoYsXLv1.js";import{e as ve,Q as te}from"./QBtn-17rgya3j.js";import{Q as G}from"./QCardSection-DVb5QnPf.js";import{Q as N}from"./QCard-B3DssZPe.js";import{a3 as W,r as a,a as q,u as X,J as w,L as I,I as d,H as l,N as v,G as H,a1 as se,a0 as ne,Q as R,a4 as D,O as K,a5 as ge,a6 as fe,a7 as Z,a8 as ye}from"./main-s4YKoVr5.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as le}from"./QInput-LBPoVTtX.js";import{Q as he}from"./QBanner-jAmze_sp.js";import{Q as Ce}from"./QExpansionItem-CLNc6SoN.js";import{u as _e}from"./useSupabaseCategoryManagement-CKGaNoCU.js";import"./QChip-Dt76Xwa_.js";import"./use-dark-8fmQ0m1E.js";import"./selection-B1NA8EGv.js";import"./format-ouHuyIa4.js";import"./use-id-DmS-GA3l.js";const be={class:"contexts-list q-pb-sm"},xe={class:"row items-center full-width"},we={class:"col"},Se={key:0,class:"col-shrink"},Te={__name:"RAGToolCategorySidePanel",emits:["update:selectedContexts"],setup(z,{emit:o}){const g=o,{fetchCategories:y,fetchSubCategories:f,fetchSavedContexts:c,SaveContextData:h}=W();a(""),a(""),a("");const C=a("");a(!1),a(null);const p=a([]),b=a([]),x=a(null),F=a(null),k=a([]),_=a([]),S=q(()=>b.value.filter(u=>{var i;return u.category_id===((i=x.value)==null?void 0:i.id)})),$=u=>{const i=p.value.find(n=>n.id===u.category_id),e=b.value.find(n=>n.id===u.sub_category_id);return`${(i==null?void 0:i.name)||"Uncategorized"}${e?` - ${e.name}`:""}`},V=q(()=>k.value.filter(u=>{const i=!x.value||u.category_id===x.value.id,e=!F.value||u.sub_category_id===F.value.id;return i&&e}));X(async()=>{try{p.value=await y(),b.value=await f(),k.value=await c()}catch(u){C.value=`Initialization error: ${u.message}`}});const A=()=>{F.value=null},E=u=>_.value.includes(u),O=u=>{const i=typeof u=="object"?u.id:u;_.value.includes(i)?_.value=_.value.filter(e=>e!==i):_.value.push(i),g("update:selectedContexts",_.value)},j=u=>{_.value=u,g("update:selectedContexts",u)},L=q(()=>{const u={};return k.value.forEach(i=>{const e=p.value.find(r=>r.id===i.category_id),n=b.value.find(r=>r.id===i.sub_category_id);if(e){u[e.id]||(u[e.id]={id:e.id,label:e.name,type:"category",children:[]});let r=n?u[e.id].children.find(B=>B.id===n.id):null;n&&!r&&(r={id:n.id,label:n.name,type:"subcategory",children:[]},u[e.id].children.push(r));const T={id:i.id,label:i.original_url,type:"context",original_url:i.original_url};r?(r.children||(r.children=[]),r.children.push(T)):u[e.id].children.push(T)}}),Object.values(u)});return(u,i)=>(w(),I(N,null,{default:d(()=>[l(G,null,{default:d(()=>[i[3]||(i[3]=v("div",{class:"text-h6"},"Categories",-1)),l(M,{class:"q-mb-md",modelValue:x.value,"onUpdate:modelValue":[i[0]||(i[0]=e=>x.value=e),A],options:p.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),l(M,{class:"q-mb-md",modelValue:F.value,"onUpdate:modelValue":i[1]||(i[1]=e=>F.value=e),options:S.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!x.value,outlined:"",dense:""},null,8,["modelValue","options","disable"]),v("div",be,[i[2]||(i[2]=v("div",{class:"text-h6"},"Saved Contexts",-1)),l(oe,{bordered:"",separator:""},{default:d(()=>[(w(!0),H(se,null,ne(V.value,e=>(w(),I(ae,{key:e.id,clickable:"",onClick:n=>O(e)},{default:d(()=>[l(ee,null,{default:d(()=>[l(J,null,{default:d(()=>[R(D(e.original_url),1)]),_:2},1024),l(J,{caption:""},{default:d(()=>[R(D($(e)),1)]),_:2},1024)]),_:2},1024),l(ee,{side:""},{default:d(()=>[l(de,{"model-value":E(e.id),"onUpdate:modelValue":n=>O(e)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),l(pe,{nodes:L.value,"node-key":"id","label-key":"label","children-key":"children","default-expand-all":"","tick-strategy":"leaf",ticked:_.value,"onUpdate:ticked":j,class:"contexts-tree q-mt-md"},{"default-header":d(e=>[v("div",xe,[v("div",we,D(e.node.label),1),e.node.type==="context"?(w(),H("div",Se,[l(ve,{name:"link",title:e.node.original_url,class:"q-ml-xs"},null,8,["title"])])):K("",!0)])]),_:1},8,["nodes","ticked"])]),_:1})]),_:1}))}},Pe=Y(Te,[["__scopeId","data-v-10a97c3d"]]);class Ie{static async processPDF(o){try{const g=await o.arrayBuffer(),y=await me(g).promise;let f="";for(let c=1;c<=y.numPages;c++){const p=(await(await y.getPage(c)).getTextContent()).items.map(b=>b.str).join(" ");f+=p+`
`}return{text:f.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}}}catch(g){throw console.error("PDF processing error:",g),new Error("Failed to process PDF file")}}static async processTextFile(o){return new Promise((g,y)=>{const f=new FileReader;f.onload=c=>{var C;const h=(C=c.target)==null?void 0:C.result;g({text:h.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=y,f.readAsText(o)})}static async processHTMLFile(o){return new Promise((g,y)=>{const f=new FileReader;f.onload=c=>{var b;const h=(b=c.target)==null?void 0:b.result,C=document.createElement("div");C.innerHTML=h;const p=C.textContent||C.innerText;g({text:p.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=y,f.readAsText(o)})}static async processRTFFile(o){return new Promise((g,y)=>{const f=new FileReader;f.onload=c=>{var p;const C=((p=c.target)==null?void 0:p.result).replace(/\\[a-z]{1,32}(-)?|\{|\}|\\\n?/gm,"").replace(/[\\{}]/g,"").replace(/[\r\n]+/g," ");g({text:C.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}})},f.onerror=y,f.readAsText(o)})}static async processDOCXFile(o){try{const g=await ge(()=>import("./index-Duv67ZIM.js").then(c=>c.i),__vite__mapDeps([0])),y=await o.arrayBuffer();return{text:(await g.extractRawText({arrayBuffer:y})).value.trim(),metadata:{originalFileName:o.name,fileType:o.type,fileSize:o.size}}}catch(g){throw console.error("DOCX processing error:",g),new Error("Failed to process DOCX file")}}static async processFile(o){const y={"application/pdf":this.processPDF,"text/plain":this.processTextFile,"text/html":this.processHTMLFile,"text/rtf":this.processRTFFile,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":this.processDOCXFile}[o.type];if(y)return await y(o);throw new Error(`Unsupported file type: ${o.type}`)}}const Fe={class:"file-upload-section"},$e={class:"row items-center url-input-section q-mb-md"},ke={class:"col-8"},Ve={class:"col"},Ae={class:"file-input-section q-mb-md"},Re={class:"category-selection"},De={class:"q-pt-md"},Ue={__name:"RAGToolAIContextManager",setup(z){const{fetchCategories:o,fetchSubCategories:g,fetchSavedContexts:y,SaveContextData:f}=W();a("");const c=a("test"),h=a(""),C=a(""),p=a(""),b=a(!1),x=a(null),F=a([]),k=a([]),_=a(null),S=a(null),$=a([]);a([{}]);const V=q(()=>h.value&&_.value);X(async()=>{try{F.value=await o(),k.value=await g(),$.value=await y()}catch(s){p.value=`Initialization error: ${s.message}`}});const A=q(()=>k.value.filter(s=>{var t;return s.category_id===((t=_.value)==null?void 0:t.id)}));q(()=>$.value.filter(s=>{const t=!_.value||s.category_id===_.value.id,m=!S.value||s.sub_category_id===S.value.id;return t&&m}));const E=()=>{S.value=null},O=()=>{h.value="",c.value="",S.value=null,x.value&&(x.value.value="")},j=(s,t=500)=>s.length>t?s.substring(0,t)+"...":s,L=s=>{s.preventDefault(),b.value=!0},u=()=>{b.value=!1},i=async s=>{if(b.value=!1,s.preventDefault(),console.log("handleDrop.. "),s.dataTransfer.files.length>0){const m=s.dataTransfer.files[0];if(console.log("Processing a dropped file.. ",m),console.log("file type:",m.type),!m.name.endsWith(".webloc"))try{await n(m)}catch(P){console.error("File drop processing error:",P),p.value=P.message}return}const t=s.dataTransfer.getData("text/plain");t&&(console.log("droppedUrl: ",t),c.value=t,r())},e=async s=>{const t=s.target.files[0];t&&await n(t)},n=async s=>{try{const t=await Ie.processFile(s);h.value=t.text,p.value=""}catch(t){p.value=`File processing error: ${t.message}`}},r=async()=>{if(!c.value){p.value="Please enter a valid URL";return}try{const t=await(await fetch(c.value)).text(),P=new DOMParser().parseFromString(t,"text/html"),Q=T(P).join(`

`);C.value=B(Q),h.value=C,p.value=""}catch(s){p.value=`URL extraction error: ${s.message}`}},T=s=>{const t=[()=>{const m=["main","article",".main-content","#main-content",".content","#content"];for(let P of m){const U=s.querySelector(P);if(U)return Array.from(U.querySelectorAll("p, h1, h2, h3, h4, h5, h6")).map(Q=>Q.textContent.trim()).filter(Q=>Q.length>0)}return[]},()=>Array.from(s.querySelectorAll("p")).map(m=>m.textContent.trim()).filter(m=>m.length>0)];for(let m of t){const P=m();return P.length>0?P:[]}},B=s=>{if(!s||s.length===0)return"No content could be extracted.";const t=s.split(`

`);if(t.length<=3)return s;const m=[],P=["summary","key points","main idea","important","conclusion","highlights","overview"];return t.forEach(U=>{const Q=U.toLowerCase();(P.some(ie=>Q.includes(ie))||U.length>100)&&m.push(U)}),m.length===0&&m.push(...t.slice(0,3)),m.join(`

`)},re=async()=>{var s;if(!V.value){p.value="Please select a category and provide content";return}try{const t=await f(c.value||"Uploaded Content",h.value,h.value.length/1e3,_.value.id,(s=S.value)==null?void 0:s.id);$.value.push(t),O()}catch(t){p.value=`Save as context error: ${t.message}`}};return(s,t)=>(w(),I(N,{class:"col-8 extraction-section"},{default:d(()=>[l(G,null,{default:d(()=>[t[6]||(t[6]=v("h5",null,"Extract and Manage AI Context",-1)),v("div",Fe,[v("div",{class:fe(["drop-zone",{"drag-active":b.value}]),onDragover:Z(L,["prevent"]),onDragleave:Z(u,["prevent"]),onDrop:Z(i,["prevent"])},t[3]||(t[3]=[v("p",null,"Drag and Drop a URL (web link) or file Here",-1)]),34),v("div",$e,[v("div",ke,[l(le,{class:"col q-ma-sm",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=m=>c.value=m),placeholder:"Enter URL to extract text",onKeyup:ye(r,["enter"])},null,8,["modelValue"])]),v("div",Ve,[l(te,{class:"q-ma-sm",onClick:r,disabled:!c.value,color:"primary"},{default:d(()=>t[4]||(t[4]=[R(" Extract URL Text ")])),_:1},8,["disabled"])])]),v("div",Ae,[v("input",{type:"file",ref_key:"fileInput",ref:x,onChange:e,accept:".pdf,.txt,.html,.rtf,.docx,.md"},null,544)]),p.value?(w(),I(he,{key:0,class:"bg-negative text-white q-mb-md"},{default:d(()=>[R(D(p.value),1)]),_:1})):K("",!0),h.value?(w(),I(Ce,{key:1,label:"Extracted Content Preview","default-opened":"",class:"q-mb-md"},{default:d(()=>[l(N,null,{default:d(()=>[l(G,null,{default:d(()=>[v("div",null,D(j(h.value)),1)]),_:1})]),_:1})]),_:1})):K("",!0)]),v("div",Re,[l(M,{modelValue:_.value,"onUpdate:modelValue":[t[1]||(t[1]=m=>_.value=m),E],options:F.value,label:"Category","option-label":"name","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),l(M,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=m=>S.value=m),options:A.value,label:"Sub-Category","option-label":"name","option-value":"id",disable:!_.value,outlined:"",dense:""},null,8,["modelValue","options","disable"])]),v("div",De,[l(te,{onClick:re,color:"positive",disable:!V.value,class:"q-mb-md"},{default:d(()=>t[5]||(t[5]=[R(" Save Context ")])),_:1},8,["disable"])])]),_:1})]),_:1}))}},Qe=Y(Ue,[["__scopeId","data-v-3e638f7f"]]),Me={key:0,class:"selected-contexts q-mb-md"},qe={class:"ai-query-section"},ze={__name:"RAGToolAIInteractionComponent",props:{selectedContexts:{type:Array,default:()=>[]}},setup(z){const o=z,{fetchCategories:g,fetchSubCategories:y,fetchSavedContexts:f}=W(),c=a(""),h=a([]),C=a([]),p=a([]),b=a(""),x=a("openai"),F=["openai","anthropic"],k=a("gpt-4o-mini"),_=a(["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"]),S=a(null),$=a(null),V=a(["Combine in Prompt"]),A=a("Combine in Prompt");new AbortController;const E="https://virtag-ai.fly.dev";X(async()=>{try{h.value=await g(),C.value=await y(),p.value=await f()}catch(e){c.value=`Initialization error: ${e.message}`}});const O=()=>{console.log("updateAIServiceOptions: "+x.value),x.value==="openai"?(_.value=["gpt-4o-mini","gpt-4o","gpt-4-turbo","gpt-3.5-turbo"],V.value=["Combine in Prompt","Upload as Files"],A.value="Combine in Prompt"):x.value==="anthropic"&&(_.value=["claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-opus-20240229"],V.value=["Combine in Prompt"],A.value="Combine in Prompt"),console.log("contextProcessingOptions: "+V.value)},j=()=>V.value,L=q(()=>p.value.filter(e=>o.selectedContexts.includes(e.id))),u=e=>{const n=h.value.find(T=>T.id===e.category_id),r=C.value.find(T=>T.id===e.sub_category_id);return`${(n==null?void 0:n.name)||"Uncategorized"}${r?` - ${r.name}`:""}`},i=async()=>{try{const e=`${E}/api/openai`;if(!$.value){const B=await(await fetch(`${e}/createThread`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();$.value=B.id}const n=await fetch(`${e}/addMessageToThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:$.value,content:b.value})}),r=await fetch(`${e}/runThread`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threadId:$.value,assistantId:"your_assistant_id"})});S.value=await r.json().then(T=>T.response)}catch(e){e.name==="AbortError"?c.value="Request was canceled":c.value=`AI query error: ${e.message}`,console.error(e)}};return(e,n)=>(w(),I(N,{class:"col-8 extraction-section"},{default:d(()=>[l(G,null,{default:d(()=>[L.value.length>0?(w(),H("div",Me,[n[4]||(n[4]=v("div",{class:"text-h6"},"Selected Contexts",-1)),l(oe,{bordered:"",separator:""},{default:d(()=>[(w(!0),H(se,null,ne(L.value,r=>(w(),I(ae,{key:r.id},{default:d(()=>[l(ee,null,{default:d(()=>[l(J,null,{default:d(()=>[R(D(r.original_url),1)]),_:2},1024),l(J,{caption:""},{default:d(()=>[R(D(u(r)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):K("",!0),v("div",qe,[l(M,{modelValue:A.value,"onUpdate:modelValue":n[0]||(n[0]=r=>A.value=r),options:j(),label:"Context Processing Method",class:"q-mb-md"},null,8,["modelValue","options"]),l(le,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=r=>b.value=r),label:"AI Query",outlined:"",type:"textarea",class:"q-mb-md"},null,8,["modelValue"]),l(M,{modelValue:x.value,"onUpdate:modelValue":[n[2]||(n[2]=r=>x.value=r),O],options:F,label:"AI Service",class:"q-mb-md"},null,8,["modelValue"]),l(M,{modelValue:k.value,"onUpdate:modelValue":n[3]||(n[3]=r=>k.value=r),options:_.value,label:"AI Model",class:"q-mb-md"},null,8,["modelValue","options"]),l(te,{onClick:i,color:"primary",disable:!b.value},{default:d(()=>n[5]||(n[5]=[R(" Send to AI ")])),_:1},8,["disable"]),S.value?(w(),I(N,{key:0,class:"q-mt-md"},{default:d(()=>[l(G,null,{default:d(()=>[n[6]||(n[6]=v("div",{class:"text-h6"},"AI Response",-1)),v("p",null,D(S.value),1)]),_:1})]),_:1})):K("",!0)])]),_:1})]),_:1}))}},Oe={class:"row"},Le={class:"col-4 category-side-panel"},Ne={class:"col-8 extraction-section"},Ee={class:"ai-query-section"},je={__name:"RagToolComponent",setup(z){const{error:o,fetchCurrentUser:g,fetchCategories:y,fetchSubCategories:f}=_e(),c=a([]),h=C=>{c.value=C};return X(async()=>{if(console.log("RagToolManagerPage mounted."),!await g()){alert("You must be signed in to Supabase to use this feature.");return}console.log("CategoryManagerPage mounted.")}),(C,p)=>(w(),I(N,{class:"ai-context-manager"},{default:d(()=>[v("div",Oe,[v("div",Le,[l(Pe,{"onUpdate:selectedContexts":h})]),v("div",Ne,[v("div",Ee,[l(ze,{"selected-contexts":c.value},null,8,["selected-contexts"])])])])]),_:1}))}},Be=Y(je,[["__scopeId","data-v-8ce014a3"]]),Ge={key:1,class:"rag-tool-content"},He={class:"main-content"},Ke={__name:"RagToolPage",setup(z){const{error:o,fetchCurrentUser:g,isUserSignedIn:y}=W(),f=a();return X(async()=>{console.log("RagToolManagerPage mounted."),f.value=await g()}),(c,h)=>(w(),I(ce,{class:"rag-tool-page"},{default:d(()=>[f.value?(w(),H("div",Ge,[v("div",He,[l(Qe),l(Be)])])):(w(),I(ue,{key:0}))]),_:1}))}},ft=Y(Ke,[["__scopeId","data-v-d19b5bd5"]]);export{ft as default};
