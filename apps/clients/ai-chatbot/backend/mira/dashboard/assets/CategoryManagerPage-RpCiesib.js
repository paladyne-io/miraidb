import{r as _,at as D,o as te,g as ae,w as V,d as u,m as t,h as p,au as m,f as A,A as F,s as I,e as g,af as E,ag as M,p as x,ai as S}from"./main-ZcZtQDJh.js";import{Q as se}from"./QCard-SY2yscR2.js";import{u as ne}from"./useSupabaseCategoryManagement-kremiuxf.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const v=i=>i.replace(/<[^>]*>/g,"").trim(),q=i=>{const o=[];return i.name?i.name.length<2?o.push("Category name must be at least 2 characters long"):i.name.length>50&&o.push("Category name cannot exceed 50 characters"):o.push("Category name is required"),i.description&&i.description.length>500&&o.push("Description cannot exceed 500 characters"),{isValid:o.length===0,errors:o}},ie=i=>{const o=[];return i.name?i.name.length<2?o.push("Subcategory name must be at least 2 characters long"):i.name.length>50&&o.push("Subcategory name cannot exceed 50 characters"):o.push("Subcategory name is required"),i.categoryId||o.push("A parent category must be selected"),i.description&&i.description.length>500&&o.push("Description cannot exceed 500 characters"),{isValid:o.length===0,errors:o}},re={class:"container"},le={class:"category-section"},ce={class:"add-category-card"},de={class:"input-group"},ue={class:"categories-grid"},pe={class:"category-header"},me={class:"category-actions"},ge=["onClick"],ye=["onClick"],ve={class:"category-description"},fe={class:"subcategory-section"},be={class:"add-subcategory-form"},Ce={key:0,class:"input-group"},he=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],Se={class:"subcategories-list"},ke={class:"subcategory-content"},we={class:"subcategory-name"},De={class:"subcategory-actions"},Ve=["onClick"],xe=["onClick"],Ue={class:"subcategory-description"},Ne={key:0,class:"modal"},Be={class:"modal-content"},ze={key:1,class:"modal"},Ae={class:"modal-content"},Fe={__name:"CategoryManagerPage",setup(i){const{error:o,user:Ie,fetchCurrentUser:P,fetchCategories:b,fetchSubCategories:k,addCategory:$,updateCategory:T,deleteCategory:j,addSubcategory:Q,deleteSubcategory:L,updateSubcategory:O}=ne(),y=_([]),C=_([]),d=D({name:"",description:""});D({});const r=_(null),l=_(null),c=D({}),Y=()=>{y.value.forEach(s=>{s.id in c||(c[s.id]={name:"",description:""})})},G=async()=>{const s=v(d.name),e=d.description?v(d.description):"",{isValid:a,errors:n}=q({name:s,description:e});if(!a){alert(n.join(`
`));return}await $(d.name,d.description)?(console.error("Add category success."),d.name="",d.description="",y.value=await b(),alert("The new category was added successfully.")):alert("Failed to add category.")},H=async s=>{if(!confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))return;await j(s)?(console.error("Delete category success."),y.value=await b()):alert("Failed to delete category.")},J=s=>{r.value={...s}},U=async()=>{var h,w,B,z;if(!((h=r.value)!=null&&h.name.trim())){alert("Category name is required");return}const s=v((w=r.value)==null?void 0:w.name),e=(B=r.value)!=null&&B.description?v((z=r.value)==null?void 0:z.description):"",{isValid:a,errors:n}=q({name:s,description:e});if(!a){alert(n.join(`
`));return}await T(r.value.id,r.value.name,r.value.description)?(console.error("Update category success."),r.value=null,y.value=await b()):alert("Failed to update category.")},N=()=>{r.value=null},K=async s=>{console.log("addSubcategoryInDB categoryId: "+s),c[s]||(c[s]={name:"",description:""});const e=c[s],a=v(e.name),n=e.description?v(e.description):"",{isValid:f,errors:h}=ie({name:a,description:n,categoryId:s});if(!f){alert(h.join(`
`));return}if(!e.name||!e.name.trim()){alert("Subcategory name is required");return}await Q(s,e.name,e.description)?(console.log("Added subcategory."),c[s].name="",c[s].description="",C.value=await k()):alert("Failed to add subcategory.")},R=async s=>{if(!confirm("Are you sure you want to delete this subcategory?"))return;await L(s)?(console.error("Delete subcategory success."),C.value=await k()):alert("Failed to delete subcategory.")},W=s=>{l.value={...s}},X=async()=>{var e;if(!((e=l.value)!=null&&e.name.trim())){alert("Subcategory name is required");return}await O(l.value.id,l.value.name,l.value.description)?(console.error("Update subcategory success."),l.value=null):alert("Failed to update subcategory.")},Z=()=>{l.value=null},ee=async()=>{const s=await b();y.value=s||[];const e=await k();C.value=e||[],Y()};return te(async()=>{if(console.log("CategoryManagerPage mounted."),!await P()){alert("You must be signed in to use this feature.");return}console.log("CategoryManagerPage mounted. Fetching categories..."),ee()}),(s,e)=>(u(),ae(se,{class:"category-management"},{default:V(()=>[t("div",re,[e[13]||(e[13]=t("h1",{class:"page-title"},"Category Management",-1)),t("div",le,[t("div",ce,[e[7]||(e[7]=t("h3",{class:"category-title q-pb-md"},"Create a New Category",-1)),t("div",de,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.name=a),placeholder:"Category Name",type:"text",class:"form-input"},null,512),[[m,d.name]]),p(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.description=a),placeholder:"Category Description (Optional)",class:"form-textarea"},null,512),[[m,d.description]]),A(I,{onClick:G,class:"btn-primary"},{default:V(()=>e[6]||(e[6]=[t("i",{class:"fas fa-plus"},null,-1),F(" Add Category ")])),_:1}),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:N},"Cancel")])])]),t("div",ue,[(u(!0),g(M,null,E(y.value,a=>(u(),g("div",{key:a.id,class:"category-card"},[t("div",pe,[t("h3",null,S(a.name),1),t("div",me,[t("button",{onClick:n=>J(a),class:"btn-edit"},e[8]||(e[8]=[t("i",{class:"fas fa-edit"},null,-1)]),8,ge),t("button",{onClick:n=>H(a.id),class:"btn-delete"},e[9]||(e[9]=[t("i",{class:"fas fa-trash"},null,-1)]),8,ye)])]),t("p",ve,S(a.description||"No description"),1),t("div",fe,[t("div",be,[c[a.id]?(u(),g("div",Ce,[p(t("input",{"onUpdate:modelValue":n=>c[a.id].name=n,placeholder:"Subcategory Name",class:"form-input"},null,8,he),[[m,c[a.id].name]]),p(t("textarea",{"onUpdate:modelValue":n=>c[a.id].description=n,placeholder:"Subcategory Description",class:"form-textarea"},null,8,_e),[[m,c[a.id].description]]),A(I,{onClick:n=>K(a.id),class:"btn-secondary"},{default:V(()=>e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),F(" Add Subcategory ")])),_:2},1032,["onClick"])])):x("",!0)]),t("div",Se,[(u(!0),g(M,null,E(C.value.filter(n=>n.category_id===a.id),n=>(u(),g("div",{key:n.id,class:"subcategory-item"},[t("div",ke,[t("span",we,S(n.name),1),t("div",De,[t("button",{onClick:f=>W(n),class:"btn-edit-small"},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ve),t("button",{onClick:f=>R(n.id),class:"btn-delete-small"},e[12]||(e[12]=[t("i",{class:"fas fa-trash"},null,-1)]),8,xe)])]),t("p",Ue,S(n.description||"No description"),1)]))),128))])])]))),128))])])]),r.value?(u(),g("div",Ne,[t("div",Be,[e[14]||(e[14]=t("h2",null,"Edit Category",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"Category Name"},null,512),[[m,r.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.description=a),placeholder:"Category Description"},null,512),[[m,r.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:N},"Cancel")])])])):x("",!0),l.value?(u(),g("div",ze,[t("div",Ae,[e[15]||(e[15]=t("h2",null,"Edit Subcategory",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.name=a),placeholder:"Subcategory Name"},null,512),[[m,l.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),placeholder:"Subcategory Description"},null,512),[[m,l.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:X},"Save"),t("button",{onClick:Z},"Cancel")])])])):x("",!0)]),_:1}))}},$e=oe(Fe,[["__scopeId","data-v-c64e98c9"]]);export{$e as default};
