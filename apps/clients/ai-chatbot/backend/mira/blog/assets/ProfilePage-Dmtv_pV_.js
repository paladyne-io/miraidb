import{b as Q,k as V,Q as B}from"./QBtn-dVAhCbIe.js";import{a as W,Q as I}from"./QPage-YZPH4k7m.js";import{Q as Y,b as G,a as T}from"./QCard-CF7dW9Dx.js";import{c as Z,a as N,h as P,g as H,af as J,r as o,k as K,S as h,a1 as C,a8 as g,ag as $,a6 as _,W as a,a2 as X,ah as O,aa as ee,b as ae,U as R,V as m,a9 as te,a5 as le,Y as E,$ as D,Z as oe,ai as se}from"./main-BGT-EbxG.js";import{a as ne,b as re}from"./private.use-form-VuIT1bw4.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie=Z({name:"QBanner",props:{...ne,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(v,{slots:p}){const{proxy:{$q:f}}=H(),b=re(v,f),i=N(()=>"q-banner row items-center"+(v.dense===!0?" q-banner--dense":"")+(b.value===!0?" q-banner--dark q-dark":"")+(v.rounded===!0?" rounded-borders":"")),y=N(()=>`q-banner__actions row items-center justify-end col-${v.inlineActions===!0?"auto":"all"}`);return()=>{const r=[P("div",{class:"q-banner__avatar col-auto row items-center self-start"},Q(p.avatar)),P("div",{class:"q-banner__content col text-body2"},Q(p.default))],u=Q(p.action);return u!==void 0&&r.push(P("div",{class:y.value},u)),P("div",{class:i.value+(v.inlineActions===!1&&u!==void 0?" q-banner--top-padding":""),role:"alert"},r)}}}),ue=["src"],de=["disabled"],ce={__name:"Avatar",props:["path","size"],emits:["upload","update:path"],setup(v,{emit:p}){const f=v,{path:b,size:i}=J(f),y=p,r=o(!1),u=o(""),w=o(),d=o(null),k=async()=>{try{const{data:s,error:n}=await O.storage.from("avatars").download(b.value);if(n)throw n;u.value=URL.createObjectURL(s)}catch(s){console.error("Error downloading image: ",s.message)}},q=()=>{d.value.click()},x=async s=>{w.value=s.target.files;try{if(r.value=!0,!w.value||w.value.length===0)throw new Error("You must select an image to upload.");const n=w.value[0],S=n.name.split(".").pop(),t=`${Math.random()}.${S}`;let{error:U}=await O.storage.from("avatars").upload(t,n);if(U)throw U;y("update:path",t),y("upload")}catch(n){alert(n.message)}finally{r.value=!1}};return K(b,()=>{b.value&&k()}),(s,n)=>(h(),C(X,null,[g("div",null,[u.value?(h(),C("img",{key:0,src:u.value,alt:"Avatar",class:"circle avatar image",style:$({height:_(i)+"em",width:_(i)+"em"})},null,12,ue)):(h(),C("div",{key:1,class:"avatar no-image",style:$({height:_(i)+"em",width:_(i)+"em"})},null,4))]),g("div",{style:$({width:_(i)+"em"})},[a(V,{flat:"",rounded:"",color:"primary",class:"upload-button q-mt-sm",disabled:r.value,icon:"upload",label:r.value?"Uploading ...":"Change Avatar",onClick:q},null,8,["disabled","label"]),g("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",ref_key:"fileInput",ref:d,onChange:x,disabled:r.value},null,40,de)],4)],64))}},me=z(ce,[["__scopeId","data-v-6951234a"]]),ve={key:0,class:"profile-field q-mt-lg text-h5 text-center"},pe={class:"avatar-container"},fe={key:0,class:"profile-field q-mt-lg"},ge={class:"profile-field"},be={class:"profile-field"},_e={class:"text-center q-mt-lg"},he={__name:"ProfilePage",setup(v){const{error:p,user:f,loading:b,getSignedInUser:i,getSignedInUserProfile:y,signOut:r,updateUserProfile:u}=ee(),w=te(),d=o(b),k=o(""),q=o(""),x=o(""),s=o(!0),n=o(!1),S=o(),t=o(f);ae(async()=>{await j()});function U(){console.log("changed"),s.value=!1}async function L(){confirm("Are you sure you want to sign out?")&&await r()&&w.push("signin")}function M(){s.value=!1,n.value=!1}async function j(){try{if(d.value=!0,f||(t.value=await i()),!f||!t.value)return;console.log("get user Profile");const l=await y();S.value=l,l&&(k.value=l.username,q.value=l.website,x.value=l.avatar_url)}catch(l){l.value=l.message}finally{d.value=!1}}async function A(){if(console.log("updateProfile"),t.value){const l={id:f.id,username:k.value,website:q.value,avatar_url:x.value,updated_at:new Date};await u(l),console.log("Updated profile"),s.value=!0,n.value=!0}}return(l,e)=>{const F=le("router-link");return h(),R(W,{class:"flex flex-center"},{default:m(()=>[a(T,{class:"my-card q-pa-lg"},{default:m(()=>[t.value?D("",!0):(h(),C("div",ve,[e[7]||(e[7]=E(" Please ")),a(F,{to:"/signin"},{default:m(()=>e[6]||(e[6]=[E("sign in")])),_:1})])),g("form",{class:"form-widget",onSubmit:se(A,["prevent"]),onChange:e[5]||(e[5]=c=>M())},[a(Y,{class:"text-center"},{default:m(()=>[g("div",pe,[a(me,{path:x.value,"onUpdate:path":e[0]||(e[0]=c=>x.value=c),onUpload:A},null,8,["path"])]),t.value?(h(),C("div",fe,[a(I,{outlined:"",id:"email",label:"Email",type:"text",modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=c=>t.value.email=c),disable:"",class:"q-mb-md"},{prepend:m(()=>[a(B,{name:"email"})]),_:1},8,["modelValue"])])):D("",!0),g("div",ge,[a(I,{outlined:"",id:"username",label:"Name",modelValue:k.value,"onUpdate:modelValue":[e[2]||(e[2]=c=>k.value=c),U],class:"q-mb-md"},{prepend:m(()=>[a(B,{name:"person"})]),_:1},8,["modelValue"])]),g("div",be,[a(I,{outlined:"",id:"website",label:"Website",type:"url",modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=c=>q.value=c),class:"q-mb-lg"},{prepend:m(()=>[a(B,{name:"language"})]),_:1},8,["modelValue"])])]),_:1}),a(G,{align:"center",class:"q-gutter-md"},{default:m(()=>[a(V,{padding:"sm md",unelevated:"",rounded:"",disabled:d.value||!t.value||s.value,type:"submit",color:"primary",onClick:e[4]||(e[4]=c=>A()),label:d.value?"Saving...":"Save Changes",loading:d.value,icon:"save"},null,8,["disabled","label","loading"]),a(V,{padding:"sm md",unelevated:"",rounded:"",onClick:L,disabled:d.value||!t.value,color:"negative",icon:"logout",label:"Sign Out"},null,8,["disabled"])]),_:1}),_(p)?(h(),R(ie,{key:0,class:"bg-negative text-white q-mt-md"},{default:m(()=>[E(oe(_(p)),1)]),_:1})):D("",!0),g("div",_e,[a(V,{flat:"",rounded:"",to:"/blog",color:"primary",icon:"article",label:"Go to Blog"})])],32)]),_:1})]),_:1})}}},Ue=z(he,[["__scopeId","data-v-003156f9"]]);export{Ue as default};
