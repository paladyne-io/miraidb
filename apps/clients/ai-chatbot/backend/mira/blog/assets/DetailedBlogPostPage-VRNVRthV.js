import{o as J,p as K,k as b,Q as W}from"./QBtn-BjiMyx2X.js";import{c as X,h as ee,a9 as F,a0 as te,aa as G,r as v,b as O,a5 as se,S as i,a1 as r,a8 as a,W as l,V as m,a6 as $,Y as p,Z as d,$ as _,a2 as N,a as ae,k as oe,U as B,a4 as le,a3 as T}from"./main-Cp0inCMI.js";import{Q as ne}from"./QImg-BS6Rbm4k.js";import{c as ie,Q as re,b as ue,a as M}from"./QList-B-EDn10j.js";import{Q as U,a as de}from"./QPage-ehS6sEf6.js";import{u as Y,B as me}from"./BlogPost-C36e3S5Y.js";import{Q as Z,a as R}from"./QCard-Qy9klsGR.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-timeout-CwAyXXX2.js";import"./private.use-form-BNh_FBiO.js";import"./format-CQ7I9BAt.js";const ce='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',j=X({name:"QSpinnerDots",props:J,setup(h){const{cSize:g,classes:k}=K(h);return()=>ee("svg",{class:k.value,fill:"currentColor",width:g.value,height:g.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:ce})}}),ve={key:0,class:"comment-text"},pe={key:1,class:"comment-text"},ge={class:"q-pt-md full-width"},fe={key:2,class:"row q-gutter-sm q-pt-lg"},_e={key:0},ye={class:"row q-gutter-sm q-pt-md"},be={class:"col-7"},he={class:"col-4"},ke={class:"row q-gutter-sm q-pt-lg"},xe={key:1,class:"error-message"},we={__name:"NewCommentComponent",props:{post:{type:Object,required:!0}},emits:["commentAdded"],setup(h,{emit:g}){const k=F(),f=g,{t:D}=te(),{addComment:x,isUserSignedIn:Q,getSignedInUserProfile:L}=G(),V=Y(),w=v(""),t=v(""),u=v(""),c=v(""),y=Q(),A=async()=>{if(!Q)return"guest";const s=await L();return s?s.username:"anon"};O(async()=>{u.value=await A()});const C=async s=>{console.log("register here..."),k.push("signin")},q=async(s,e)=>{console.log("submitting comment...",s);const o=await x(s,e,u.value);o?(console.log("Added user comment: "+e),V.updatePostComments(s,o),t.value="",c.value="",f("commentAdded",o)):(c.value="Error adding user comment!",console.error(c.value))},S=async(s,e)=>{console.log("submitGuestComment: "+e);const o=await x(s,e,u.value||"guest");o?(console.log("Added guest comment: "+e),V.updatePostComments(s,o),t.value="",c.value="",f("commentAdded",o)):(c.value="Error adding guest comment",console.error(c.value))};function P(s){return/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/.test(s)}function E(){return D("type_email_address")}function z(s){const e=E();return!s||s.length===0?!0:P(s)||e}const I=()=>{const s=w.value.trim();return console.log("verifyEmail: "+s),console.log("Email OK: "+P(s)),P(s)};return(s,e)=>{const o=se("router-link");return i(),r(N,null,[a("div",null,[l(R,{class:"q-mt-md"},{default:m(()=>[l(Z,null,{default:m(()=>[$(y)?(i(),r("span",ve,[e[5]||(e[5]=p("Commenting as ")),l(o,{to:{name:"profile"}},{default:m(()=>[p(d(u.value),1)]),_:1}),e[6]||(e[6]=p("."))])):(i(),r("span",pe,[e[8]||(e[8]=p("Commenting as a guest. ")),l(o,{class:"route-link",to:"/signin"},{default:m(()=>e[7]||(e[7]=[p("Please sign in ")])),_:1})])),a("div",ge,[l(U,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value=n),type:"textarea",label:"Add a comment",filled:""},null,8,["modelValue"])]),$(y)?(i(),r("div",fe,[l(b,{onClick:e[1]||(e[1]=n=>q(h.post.id,t.value)),label:"Post Comment",color:"primary",disabled:!t.value.trim()},null,8,["disabled"])])):_("",!0)]),_:1})]),_:1})]),$(y)?_("",!0):(i(),r("div",_e,[l(R,{class:"q-mt-md"},{default:m(()=>[l(Z,null,{default:m(()=>[e[9]||(e[9]=a("p",{class:"comment-text"},"Please enter your email to register or press the button below to comment as a guest. If you submit a comment without an email address your comment will be moderated and shown after it is approved. After registering, check your email for a verification link. If you sign in you can comment without this form.",-1)),a("div",ye,[a("div",be,[l(U,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=n=>w.value=n),type:"email",ref:"emailAddress",rules:[n=>!!n||s.$t("enter_your_email_address"),z],autocomplete:"username",minlength:"6",maxlength:"50",outlined:"",label:s.$t("email"),hint:"Your email will not be displayed"},null,8,["modelValue","rules","label"])]),a("div",he,[l(U,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value=n),type:"text",minlength:"2",maxlength:"20",outlined:"",label:s.$t("name"),hint:"The name that will be displayed next to your comment."},null,8,["modelValue","label"])])]),a("div",ke,[l(b,{disabled:!I(),onClick:C,label:"Register",color:"secondary"},null,8,["disabled"]),l(b,{onClick:e[4]||(e[4]=n=>S(h.post.id,t.value)),label:"Comment as Guest",color:"primary"})])]),_:1})]),_:1})])),c.value?(i(),r("div",xe,d(c.value),1)):_("",!0)],64)}}},Ce=H(we,[["__scopeId","data-v-c54614ce"]]),qe={key:0,class:"text-center q-mt-xl"},Pe={key:1,class:"text-center text-negative q-mt-xl"},$e={class:"post-container"},Qe={class:"post-header q-mb-xl hero-header"},Ve={class:"row justify-between q-mt-md"},Ae={class:"col-8"},Se={class:"text-h3"},Ie={class:"row post-meta q-gutter-x-md"},Be={class:"text-grey-7"},Ne={class:"text-primary"},Ee={class:"text-grey-8"},ze={key:0,class:"col-4 self-end"},Me={class:"text-right"},Ue={class:"post-content q-mb-xl"},De={class:"text-body1 css-fix"},Le={class:"interaction-section q-mb-xl"},Te={class:"row justify-between q-gutter-md"},Ze={class:"q-ml-sm text-body1"},Re={key:0,class:"comments-section q-mt-lg"},je={key:0,class:"text-center"},Fe={key:1,class:"text-subtitle1"},Ge={key:0,class:"related-posts q-mt-xl"},Oe={class:"row q-col-gutter-md"},Ye={__name:"DetailedBlogPostPage",setup(h){const g=le(),k=F(),f=Y(),{user:D,formatDate:x,getComments:Q,getTranslatedPostId:L,likePost:V,getPost:w}=G(),t=v(null),u=v([{}]),c=v(!1),y=v(null),A=v(!0),C=v(null),q=v(!0),S=ae(()=>!t.value||!f.posts?[]:f.posts.filter(e=>e.id===t.value.id?!1:e.category===t.value.category||e.author===t.value.author).slice(0,3)),P=async e=>{q.value=!0,u.value=await Q(e),q.value=!1};function E(e){e&&(!u.value||u.value.length===0?u.value.unshift(e):u.value.push(e))}const z=async()=>{!t.value||t.value.liked||(await V(t.value.id),t.value.liked=!0,t.value.likes=(t.value.likes||0)+1)},I=async e=>{console.log("Opening post..."),k.push({name:"view-post",params:{id:e}})},s=async e=>{if(console.log("Detailed blog post (re)loaded"),t.value=f.posts.find(o=>o.id===e),!t.value)try{t.value=await w(e)}catch{C.value="Failed to load post"}t.value&&(await P(t.value.id),y.value=await f.getImageForPost(t.value)),A.value=!1};return oe(()=>g.params.id,async e=>{s(e)}),O(async()=>{s(g.params.id)}),(e,o)=>(i(),B(de,{class:"detailed-blog-page q-pa-md"},{default:m(()=>[A.value?(i(),r("div",qe,[l(j,{color:"primary",size:"40px"})])):C.value?(i(),r("div",Pe,d(C.value),1)):t.value?(i(),r(N,{key:2},[l(b,{flat:"",color:"primary",icon:"arrow_back",label:"Back to Blog",to:"/blog",class:"q-mb-md"}),a("div",$e,[a("div",Qe,[a("div",Ve,[a("div",Ae,[a("h1",Se,d(t.value.title),1),a("div",Ie,[a("span",Be,d($(x)(t.value.created_at)),1),a("span",Ne,d(t.value.category||"Uncategorized"),1),a("span",Ee,"by "+d(t.value.author||"Anonymous"),1)])]),t.value.translation_available&&t.value.linked_post_id?(i(),r("div",ze,[a("div",Me,[p(" linked_post_id"+d(t.value.linked_post_id)+" ",1),l(b,{color:"secondary",label:"View Japanese Version",onClick:o[0]||(o[0]=n=>s(t.value.linked_post_id))})])])):_("",!0)])]),l(ne,{fit:"contain",src:y.value,class:"post-image q-mb-lg",onClick:o[1]||(o[1]=n=>I(t.value.id))},null,8,["src"]),a("div",Ue,[a("p",De,d(t.value.content),1)]),a("div",Le,[a("div",Te,[a("div",{class:"like-section row items-center cursor-pointer",onClick:z},[l(W,{name:"favorite",color:t.value.liked?"red":"grey",size:"24px"},null,8,["color"]),a("span",Ze,d(t.value.likes||0),1)]),l(b,{unelevated:"",color:"orange-8",icon:"comment",label:`Comments (${u.value.length})`,onClick:o[2]||(o[2]=n=>c.value=!c.value)},null,8,["label"])])]),c.value?(i(),r("div",Re,[o[3]||(o[3]=a("h2",{class:"text-h5 q-mb-md"},"Comments",-1)),q.value?(i(),r("div",je,[l(j,{color:"primary",size:"40px"})])):(i(),r("div",Fe,[l(ie,null,{default:m(()=>[(i(!0),r(N,null,T(u.value,n=>(i(),B(re,{key:n.id},{default:m(()=>[l(ue,null,{default:m(()=>[n.approved?(i(),B(M,{key:0},{default:m(()=>[p(d(n.username)+" : "+d(n.content),1)]),_:2},1024)):(i(),B(M,{key:1,class:"text-negative text-italic"},{default:m(()=>[p(d(n.username)+" : Comment awaiting approval",1)]),_:2},1024)),l(M,{caption:""},{default:m(()=>[p(d($(x)(n.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Ce,{post:t.value,onCommentAdded:E},null,8,["post"])]))])):_("",!0)]),S.value.length>0?(i(),r("div",Ge,[o[4]||(o[4]=a("h2",{class:"text-h5 q-mb-lg"},"Related Posts",-1)),a("div",Oe,[(i(!0),r(N,null,T(S.value,n=>(i(),r("div",{key:n.id,class:"col-12 col-md-4 col-sm-6"},[l(me,{post:n,onViewPost:I},null,8,["post"])]))),128))])])):_("",!0)],64)):_("",!0)]),_:1}))}},nt=H(Ye,[["__scopeId","data-v-5b73d443"]]);export{nt as default};
