import{aw as A,r as g,a3 as Q,a as v,c as E,B as F,u as M,h as c,T as H,w as U,g as x}from"./main-Cy-8TsDC.js";import{h as K,l as O,q as R}from"./QBtn-vqfJp63-.js";import{u as N}from"./format-XIK6PcIC.js";const Z=A("posts",()=>{const e=g([]),r=g({}),{fetchPosts:s,downloadImage:P,getPost:q,deletePost:S,getComments:T}=Q(),h="/";console.log("PostsStore BASE_URL: ",h);const w=h+"images/placeholders/esaias-tan-MKvjc2kar7Q-unsplash.jpg",b=async()=>{console.log("loading posts...");const t=await s();if(!t){alert("fetchedPosts is null");return}console.log("fetchedPosts: ",t.length),e.value=t.map(i=>(i.liked=!1,i.image_url||(i.local_image=!0,i.image_url=w),i))},y=()=>w,_=t=>{const i=e.value.find(n=>n.id===t);return i||null},o=async t=>{await S(t),e.value=e.value.filter(i=>i.id!==t),alert("Post deleted successfully!")},l=async t=>{if(t.image)return console.log("Returning image from post: "+t.image),t.image;if(t.local_image||t.image_url.startsWith("/images"))return t.image_url;if(t.image_url){const i=`${t.image_url}-${t.image_size}`,n=d(i);if(n)return console.log("Returning cached image for post: "+n),n;console.log("Downloading image from URL: "+t.image_url);const u=await P(t.image_url);return C(i,u),t.image=u,m(t.id,u),console.log("Downloaded image and updated post:",t),u}return null},m=(t,i)=>{const n=e.value.findIndex(u=>u.id===t);n!==-1&&(e.value[n].image=i)},d=t=>r.value[t]||null,C=(t,i)=>{r.value[t]=i};return{posts:e,getPlaceholderImage:y,loadPosts:b,getImageForPost:l,getPostById:_,deletePost:o,updatePostImage:m,cacheImage:C,getCachedImage:d,updatePostComments:(t,i)=>{const n=_(t);n&&(n.comments||(n.comments=[]),n.comments.push(i))},getPostComments:async t=>{const i=await T(t),n=_(t);n&&(n.comments=i)}}}),W={ratio:[String,Number]};function G(e,r){return v(()=>{const s=Number(e.ratio||(r!==void 0?r.value:void 0));return isNaN(s)!==!0&&s>0?{paddingBottom:`${100/s}%`}:null})}const J=1.7778,p=E({name:"QImg",props:{...W,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:J},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:r,emit:s}){const P=g(e.initialRatio),q=G(e,P),S=x(),{registerTimeout:T,removeTimeout:h}=N(),{registerTimeout:w,removeTimeout:b}=N(),y=v(()=>e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null),_=v(()=>e.errorSrc!==void 0?{src:e.errorSrc,__qerror:!0}:null),o=[g(null),g(y.value)],l=g(0),m=g(!1),d=g(!1),C=v(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),L=v(()=>({width:e.width,height:e.height})),k=v(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition q-img__image--`),t=v(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));function i(){if(b(),e.loadingShowDelay===0){m.value=!0;return}w(()=>{m.value=!0},e.loadingShowDelay)}function n(){b(),m.value=!1}function u({target:a}){R(S)===!1&&(h(),P.value=a.naturalHeight===0?.5:a.naturalWidth/a.naturalHeight,z(a,1))}function z(a,f){f===1e3||R(S)===!0||(a.complete===!0?j(a):T(()=>{z(a,f+1)},50))}function j(a){R(S)!==!0&&(l.value=l.value^1,o[l.value].value=null,n(),a.getAttribute("__qerror")!=="true"&&(d.value=!1),s("load",a.currentSrc||a.src))}function D(a){h(),n(),d.value=!0,o[l.value].value=_.value,o[l.value^1].value=y.value,s("error",a)}function B(a){const f=o[a].value,I={key:"img_"+a,class:k.value,style:t.value,alt:e.alt,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...f};return l.value===a?Object.assign(I,{class:I.class+"current",onLoad:u,onError:D}):I.class+="loaded",c("div",{class:"q-img__container absolute-full",key:"img"+a},c("img",I))}function $(){return m.value===!1?c("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},K(r[d.value===!0?"error":"default"])):c("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},r.loading!==void 0?r.loading():e.noSpinner===!0?void 0:[c(O,{color:e.spinnerColor,size:e.spinnerSize})])}{let a=function(){U(()=>e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null,f=>{h(),d.value=!1,f===null?(n(),o[l.value^1].value=y.value):i(),o[l.value].value=f},{immediate:!0})};F.value===!0?M(a):a()}return()=>{const a=[];return q.value!==null&&a.push(c("div",{key:"filler",style:q.value})),o[0].value!==null&&a.push(B(0)),o[1].value!==null&&a.push(B(1)),a.push(c(H,{name:"q-transition--fade"},$)),c("div",{key:"main",class:C.value,style:L.value,role:"img","aria-label":e.alt},a)}}});export{p as Q,Z as u};
