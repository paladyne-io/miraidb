import{br as A,r as g,ah as M,c as v,I as Q,aJ as N,bs as E,o as F,J as c,T as U,K as H,ar as K,U as x,bt as R,M as J}from"./main-Dr27rr12.js";const X=A("posts",()=>{const e=g([]),r=g({}),{fetchPosts:s,downloadImage:P,getPost:T,deletePost:S,getComments:q}=M(),h="/";console.log("PostsStore BASE_URL: ",h);const b=h+"images/placeholders/esaias-tan-MKvjc2kar7Q-unsplash.jpg",w=async()=>{console.log("loading posts...");const t=await s();if(!t){alert("fetchedPosts is null");return}console.log("fetchedPosts: ",t.length),e.value=t.map(i=>(i.liked=!1,i.image_url||(i.local_image=!0,i.image_url=b),i))},y=()=>b,_=t=>{const i=e.value.find(n=>n.id===t);return i||null},o=async t=>{await S(t),e.value=e.value.filter(i=>i.id!==t),alert("Post deleted successfully!")},l=async t=>{if(t.image)return console.log("Returning image from post: "+t.image),t.image;if(t.local_image||t.image_url.startsWith("/images"))return t.image_url;if(t.image_url){const i=`${t.image_url}-${t.image_size}`,n=d(i);if(n)return console.log("Returning cached image for post: "+n),n;console.log("Downloading image from URL: "+t.image_url);const u=await P(t.image_url);return I(i,u),t.image=u,m(t.id,u),console.log("Downloaded image and updated post:",t),u}return null},m=(t,i)=>{const n=e.value.findIndex(u=>u.id===t);n!==-1&&(e.value[n].image=i)},d=t=>r.value[t]||null,I=(t,i)=>{r.value[t]=i};return{posts:e,getPlaceholderImage:y,loadPosts:w,getImageForPost:l,getPostById:_,deletePost:o,updatePostImage:m,cacheImage:I,getCachedImage:d,updatePostComments:(t,i)=>{const n=_(t);n&&(n.comments||(n.comments=[]),n.comments.push(i))},getPostComments:async t=>{const i=await q(t),n=_(t);n&&(n.comments=i)}}}),O={ratio:[String,Number]};function W(e,r){return v(()=>{const s=Number(e.ratio||(r!==void 0?r.value:void 0));return isNaN(s)!==!0&&s>0?{paddingBottom:`${100/s}%`}:null})}const G=1.7778,Y=Q({name:"QImg",props:{...O,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:G},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:r,emit:s}){const P=g(e.initialRatio),T=W(e,P),S=J(),{registerTimeout:q,removeTimeout:h}=N(),{registerTimeout:b,removeTimeout:w}=N(),y=v(()=>e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null),_=v(()=>e.errorSrc!==void 0?{src:e.errorSrc,__qerror:!0}:null),o=[g(null),g(y.value)],l=g(0),m=g(!1),d=g(!1),I=v(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),L=v(()=>({width:e.width,height:e.height})),k=v(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition q-img__image--`),t=v(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));function i(){if(w(),e.loadingShowDelay===0){m.value=!0;return}b(()=>{m.value=!0},e.loadingShowDelay)}function n(){w(),m.value=!1}function u({target:a}){R(S)===!1&&(h(),P.value=a.naturalHeight===0?.5:a.naturalWidth/a.naturalHeight,z(a,1))}function z(a,f){f===1e3||R(S)===!0||(a.complete===!0?j(a):q(()=>{z(a,f+1)},50))}function j(a){R(S)!==!0&&(l.value=l.value^1,o[l.value].value=null,n(),a.getAttribute("__qerror")!=="true"&&(d.value=!1),s("load",a.currentSrc||a.src))}function D(a){h(),n(),d.value=!0,o[l.value].value=_.value,o[l.value^1].value=y.value,s("error",a)}function B(a){const f=o[a].value,C={key:"img_"+a,class:k.value,style:t.value,alt:e.alt,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...f};return l.value===a?Object.assign(C,{class:C.class+"current",onLoad:u,onError:D}):C.class+="loaded",c("div",{class:"q-img__container absolute-full",key:"img"+a},c("img",C))}function $(){return m.value===!1?c("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},H(r[d.value===!0?"error":"default"])):c("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},r.loading!==void 0?r.loading():e.noSpinner===!0?void 0:[c(K,{color:e.spinnerColor,size:e.spinnerSize})])}{let a=function(){x(()=>e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null,f=>{h(),d.value=!1,f===null?(n(),o[l.value^1].value=y.value):i(),o[l.value].value=f},{immediate:!0})};E.value===!0?F(a):a()}return()=>{const a=[];return T.value!==null&&a.push(c("div",{key:"filler",style:T.value})),o[0].value!==null&&a.push(B(0)),o[1].value!==null&&a.push(B(1)),a.push(c(U,{name:"q-transition--fade"},$)),c("div",{key:"main",class:I.value,style:L.value,role:"img","aria-label":e.alt},a)}}});export{Y as Q,X as u};
