import{am as y,r as u,a3 as C}from"./main-pQ6I3G1N.js";const x=y("posts",()=>{const s=u([]),l=u({}),{fetchPosts:d,downloadImage:f,getPost:p,deletePost:P,getComments:h}=C(),c="/";console.log("PostsStore BASE_URL: ",c);const m=c+"images/placeholders/esaias-tan-MKvjc2kar7Q-unsplash.jpg",_=async()=>{console.log("loading posts...");const e=await d();if(!e){alert("fetchedPosts is null");return}console.log("fetchedPosts: ",e.length),s.value=e.map(t=>(t.liked=!1,t.image_url||(t.local_image=!0,t.image_url=m),t))},I=()=>m,n=e=>{const t=s.value.find(o=>o.id===e);return t||null},v=async e=>{await P(e),s.value=s.value.filter(t=>t.id!==e),alert("Post deleted successfully!")},w=async e=>{if(e.image)return console.log("Returning image from post: "+e.image),e.image;if(e.local_image||e.image_url.startsWith("/images"))return e.image_url;if(e.image_url){const t=`${e.image_url}-${e.image_size}`,o=g(t);if(o)return console.log("Returning cached image for post: "+o),o;console.log("Downloading image from URL: "+e.image_url);const a=await f(e.image_url);return i(t,a),e.image=a,r(e.id,a),console.log("Downloaded image and updated post:",e),a}return null},r=(e,t)=>{const o=s.value.findIndex(a=>a.id===e);o!==-1&&(s.value[o].image=t)},g=e=>l.value[e]||null,i=(e,t)=>{l.value[e]=t};return{posts:s,getPlaceholderImage:I,loadPosts:_,getImageForPost:w,getPostById:n,deletePost:v,updatePostImage:r,cacheImage:i,getCachedImage:g,updatePostComments:(e,t)=>{const o=n(e);o&&(o.comments||(o.comments=[]),o.comments.push(t))},getPostComments:async e=>{const t=await h(e),o=n(e);o&&(o.comments=t)}}});export{x as u};
