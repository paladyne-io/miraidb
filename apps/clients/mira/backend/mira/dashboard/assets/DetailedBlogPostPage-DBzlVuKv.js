import{c as K,F as Y,G as W,B as b,Q as X}from"./QBtn-DIoc87Ox.js";import{h as ee,J as Z,A as te,r as v,a as j,E as se,k as i,B as r,I as a,q as l,m,G as $,x as p,y as d,z as _,F as E,D as ae,c as oe,b as le,l as S,C as T}from"./main-hG9iqqgt.js";import{Q as ne}from"./QImg-DAjbbFlS.js";import{c as ie,Q as re,b as ue,a as M}from"./QList-C5L6J9Ap.js";import{u as O,Q as D,a as de}from"./useSupabase-7GUBluXm.js";import{u as J,B as me}from"./BlogPost-xVXbLESr.js";import{Q as F,a as G}from"./QCard-BqXPu3Lc.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./private.use-form-D0SpCY30.js";import"./use-timeout-DWybTr3f.js";import"./format-BpxpRWoF.js";const ce='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',R=K({name:"QSpinnerDots",props:Y,setup(h){const{cSize:g,classes:k}=W(h);return()=>ee("svg",{class:k.value,fill:"currentColor",width:g.value,height:g.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:ce})}}),ve={key:0,class:"comment-text"},pe={key:1,class:"comment-text"},ge={class:"q-pt-md full-width"},fe={key:2,class:"row q-gutter-sm q-pt-lg"},_e={key:0},ye={class:"row q-gutter-sm q-pt-md"},be={class:"col-7"},he={class:"col-4"},ke={class:"row q-gutter-sm q-pt-lg"},xe={key:1,class:"error-message"},Ce={__name:"NewCommentComponent",props:{post:{type:Object,required:!0}},emits:["commentAdded"],setup(h,{emit:g}){const k=Z(),f=g,{t:U}=te(),{addComment:x,isUserSignedIn:Q,getSignedInUserProfile:L}=O(),A=J(),C=v(""),t=v(""),u=v(""),c=v(""),y=Q(),V=async()=>{if(!Q)return"guest";const s=await L();return s?s.username:"anon"};j(async()=>{u.value=await V()});const w=async s=>{console.log("register here..."),k.push("signin")},q=async(s,e)=>{console.log("submitting comment...",s);const o=await x(s,e,u.value);o?(console.log("Added user comment: "+e),A.updatePostComments(s,o),t.value="",c.value="",f("commentAdded",o)):(c.value="Error adding user comment!",console.error(c.value))},B=async(s,e)=>{console.log("submitGuestComment: "+e);const o=await x(s,e,u.value||"guest");o?(console.log("Added guest comment: "+e),A.updatePostComments(s,o),t.value="",c.value="",f("commentAdded",o)):(c.value="Error adding guest comment",console.error(c.value))};function P(s){return/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/.test(s)}function N(){return U("type_email_address")}function z(s){const e=N();return!s||s.length===0?!0:P(s)||e}const I=()=>{const s=C.value.trim();return console.log("verifyEmail: "+s),console.log("Email OK: "+P(s)),P(s)};return(s,e)=>{const o=se("router-link");return i(),r(E,null,[a("div",null,[l(G,{class:"q-mt-md"},{default:m(()=>[l(F,null,{default:m(()=>[$(y)?(i(),r("span",ve,[e[5]||(e[5]=p("Commenting as ")),l(o,{to:{name:"profile"}},{default:m(()=>[p(d(u.value),1)]),_:1}),e[6]||(e[6]=p("."))])):(i(),r("span",pe,[e[8]||(e[8]=p("Commenting as a guest. ")),l(o,{to:"/signin"},{default:m(()=>e[7]||(e[7]=[p("Please sign in ")])),_:1})])),a("div",ge,[l(D,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value=n),type:"textarea",label:"Add a comment",filled:""},null,8,["modelValue"])]),$(y)?(i(),r("div",fe,[l(b,{onClick:e[1]||(e[1]=n=>q(h.post.id,t.value)),label:"Post Comment",color:"primary",disabled:!t.value.trim()},null,8,["disabled"])])):_("",!0)]),_:1})]),_:1})]),$(y)?_("",!0):(i(),r("div",_e,[l(G,{class:"q-mt-md"},{default:m(()=>[l(F,null,{default:m(()=>[e[9]||(e[9]=a("p",{class:"comment-text"},"Please enter your email to register or press the button below to comment as a guest. If you submit a comment without an email address your comment will be moderated and shown after it is approved. After registering, check your email for a verification link. If you sign in you can comment without this form.",-1)),a("div",ye,[a("div",be,[l(D,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=n=>C.value=n),type:"email",ref:"emailAddress",rules:[n=>!!n||s.$t("enter_your_email_address"),z],autocomplete:"username",minlength:"6",maxlength:"50",outlined:"",label:s.$t("email"),hint:"Your email will not be displayed"},null,8,["modelValue","rules","label"])]),a("div",he,[l(D,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value=n),type:"text",minlength:"2",maxlength:"20",outlined:"",label:s.$t("name"),hint:"The name that will be displayed next to your comment."},null,8,["modelValue","label"])])]),a("div",ke,[l(b,{disabled:!I(),onClick:w,label:"Register",color:"secondary"},null,8,["disabled"]),l(b,{onClick:e[4]||(e[4]=n=>B(h.post.id,t.value)),label:"Comment as Guest",color:"primary"})])]),_:1})]),_:1})])),c.value?(i(),r("div",xe,d(c.value),1)):_("",!0)],64)}}},we=H(Ce,[["__scopeId","data-v-22339372"]]),qe={key:0,class:"text-center q-mt-xl"},Pe={key:1,class:"text-center text-negative q-mt-xl"},$e={class:"post-container"},Qe={class:"post-header q-mb-xl hero-header"},Ae={class:"row justify-between q-mt-md"},Ve={class:"col-8"},Be={class:"text-h3"},Ie={class:"row post-meta q-gutter-x-md"},Se={class:"text-grey-7"},Ee={class:"text-primary"},Ne={class:"text-grey-8"},ze={key:0,class:"col-4 self-end"},Me={class:"text-right"},De={class:"post-content q-mb-xl"},Ue={class:"text-body1 css-fix"},Le={class:"interaction-section q-mb-xl"},Te={class:"row justify-between q-gutter-md"},Fe={class:"q-ml-sm text-body1"},Ge={key:0,class:"comments-section q-mt-lg"},Re={key:0,class:"text-center"},Ze={key:1,class:"text-subtitle1"},je={key:0,class:"related-posts q-mt-xl"},Oe={class:"row q-col-gutter-md"},Je={__name:"DetailedBlogPostPage",setup(h){const g=ae(),k=Z(),f=J(),{user:U,formatDate:x,getComments:Q,getTranslatedPostId:L,likePost:A,getPost:C}=O(),t=v(null),u=v([{}]),c=v(!1),y=v(null),V=v(!0),w=v(null),q=v(!0),B=oe(()=>!t.value||!f.posts?[]:f.posts.filter(e=>e.id===t.value.id?!1:e.category===t.value.category||e.author===t.value.author).slice(0,3)),P=async e=>{q.value=!0,u.value=await Q(e),q.value=!1};function N(e){e&&(!u.value||u.value.length===0?u.value.unshift(e):u.value.push(e))}const z=async()=>{!t.value||t.value.liked||(await A(t.value.id),t.value.liked=!0,t.value.likes=(t.value.likes||0)+1)},I=async e=>{console.log("Opening post..."),k.push({name:"view-post",params:{id:e}})},s=async e=>{if(console.log("Detailed blog post (re)loaded"),t.value=f.posts.find(o=>o.id===e),!t.value)try{t.value=await C(e)}catch{w.value="Failed to load post"}t.value&&(await P(t.value.id),y.value=await f.getImageForPost(t.value)),V.value=!1};return le(()=>g.params.id,async e=>{s(e)}),j(async()=>{s(g.params.id)}),(e,o)=>(i(),S(de,{class:"detailed-blog-page q-pa-md"},{default:m(()=>[V.value?(i(),r("div",qe,[l(R,{color:"primary",size:"40px"})])):w.value?(i(),r("div",Pe,d(w.value),1)):t.value?(i(),r(E,{key:2},[l(b,{flat:"",color:"primary",icon:"arrow_back",label:"Back to Blog",to:"/blog",class:"q-mb-md"}),a("div",$e,[a("div",Qe,[a("div",Ae,[a("div",Ve,[a("h1",Be,d(t.value.title),1),a("div",Ie,[a("span",Se,d($(x)(t.value.created_at)),1),a("span",Ee,d(t.value.category||"Uncategorized"),1),a("span",Ne,"by "+d(t.value.author||"Anonymous"),1)])]),t.value.translation_available&&t.value.linked_post_id?(i(),r("div",ze,[a("div",Me,[p(" linked_post_id"+d(t.value.linked_post_id)+" ",1),l(b,{color:"secondary",label:"View Japanese Version",onClick:o[0]||(o[0]=n=>s(t.value.linked_post_id))})])])):_("",!0)])]),l(ne,{fit:"contain",src:y.value,ratio:16/9,class:"post-image q-mb-lg",onClick:o[1]||(o[1]=n=>I(t.value.id))},null,8,["src"]),a("div",De,[a("p",Ue,d(t.value.content),1)]),a("div",Le,[a("div",Te,[a("div",{class:"like-section row items-center cursor-pointer",onClick:z},[l(X,{name:"favorite",color:t.value.liked?"red":"grey",size:"24px"},null,8,["color"]),a("span",Fe,d(t.value.likes||0),1)]),l(b,{unelevated:"",color:"orange-8",icon:"comment",label:`Comments (${u.value.length})`,onClick:o[2]||(o[2]=n=>c.value=!c.value)},null,8,["label"])])]),c.value?(i(),r("div",Ge,[o[3]||(o[3]=a("h2",{class:"text-h5 q-mb-md"},"Comments",-1)),q.value?(i(),r("div",Re,[l(R,{color:"primary",size:"40px"})])):(i(),r("div",Ze,[l(ie,null,{default:m(()=>[(i(!0),r(E,null,T(u.value,n=>(i(),S(re,{key:n.id},{default:m(()=>[l(ue,null,{default:m(()=>[n.approved?(i(),S(M,{key:0},{default:m(()=>[p(d(n.username)+" : "+d(n.content),1)]),_:2},1024)):(i(),S(M,{key:1,class:"text-negative text-italic"},{default:m(()=>[p(d(n.username)+" : Comment awaiting approval",1)]),_:2},1024)),l(M,{caption:""},{default:m(()=>[p(d($(x)(n.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(we,{post:t.value,onCommentAdded:N},null,8,["post"])]))])):_("",!0)]),B.value.length>0?(i(),r("div",je,[o[4]||(o[4]=a("h2",{class:"text-h5 q-mb-lg"},"Related Posts",-1)),a("div",Oe,[(i(!0),r(E,null,T(B.value,n=>(i(),r("div",{key:n.id,class:"col-12 col-md-4 col-sm-6"},[l(me,{post:n,onViewPost:I},null,8,["post"])]))),128))])])):_("",!0)],64)):_("",!0)]),_:1}))}},nt=H(Je,[["__scopeId","data-v-efa80876"]]);export{nt as default};
