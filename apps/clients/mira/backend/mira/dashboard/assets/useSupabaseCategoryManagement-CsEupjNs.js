import{e as y,Q as m}from"./QBtn-D6I3yaUk.js";import{_ as h}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{H as _,E as b,L as d,F as g,ab as a,r as u}from"./main-pQ6I3G1N.js";const C={class:"not-signed-in-container"},w={class:"not-signed-in-message"},S={__name:"NotSignedInComponent",setup(n){return(c,l)=>(_(),b("div",C,[d("div",w,[g(y,{name:"warning",size:"lg",color:"warning"}),l[0]||(l[0]=d("p",null,"You are not signed in. Please sign in to access this feature.",-1)),g(m,{size:"lg",padding:"sm lg",color:"primary",label:"Sign In",to:"/dashboard/admin-signin"})])]))}},I=h(S,[["__scopeId","data-v-c92f261d"]]),x=n=>{if(!n)return"";const c={year:"numeric",month:"long",day:"numeric"};return new Date(n).toLocaleDateString(void 0,c)};let s=null;const f=async()=>{console.log("Fetching user...");const{data:{user:n},error:c}=await a.auth.getUser();return c?(console.error("Error fetching user:",c),null):(s=n,s)};f();const Q=()=>(u([]),u(!1),u(!1),u(null),{user:s,isUserSignedIn:()=>s!==null,fetchCurrentUser:f,addCategory:async(r,e)=>{if(!r.trim())return console.error("Category name is required"),null;try{const{data:t,error:o}=await a.from("categories").insert({name:r.trim(),description:(e==null?void 0:e.trim())||null,user_id:s.id}).select();if(o)throw o;return t}catch(t){return console.error("Add category error:",t),null}},deleteCategory:async r=>{if(confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))try{await a.from("sub_categories").delete().eq("category_id",r);const{error:e}=await a.from("categories").delete().eq("id",r);if(e)throw e;return!0}catch(e){return console.error("Delete category error:",e),!1}},updateCategory:async(r,e,t)=>{if(!e.trim())return alert("Category name is required"),!1;try{const{error:o}=await a.from("categories").update({name:e.trim(),description:(t==null?void 0:t.trim())||null,user_id:s.id}).eq("id",r);if(o)throw o;return!0}catch(o){return console.error("Update category error:",o),!1}},addSubcategory:async(r,e,t)=>{if(!e.trim())return alert("Subcategory name is required"),null;try{const{data:o,error:i}=await a.from("sub_categories").insert({name:e.trim(),category_id:r,description:(t==null?void 0:t.trim())||null,user_id:s.id}).select();if(i)throw i;return o}catch(o){return console.error("Failed to add subcategory. error:",o),null}},deleteSubcategory:async r=>{if(!confirm("Are you sure you want to delete this subcategory?"))return!1;try{const{error:e}=await a.from("sub_categories").delete().eq("id",r);if(e)throw e;return!0}catch(e){return console.error("Delete subcategory error:",e),!1}},updateSubcategory:async(r,e,t)=>{if(e.trim())return alert("Subcategory name is required"),!1;try{const{error:o}=await a.from("sub_categories").update({name:e.trim(),description:(t==null?void 0:t.trim())||null,user_id:s.id}).eq("id",r);if(o)throw o;return!0}catch(o){return console.error("Update subcategory error:",o),!1}},fetchCategories:async()=>{console.log("Fetching categories...");const{data:r,error:e}=await a.from("categories").select("*").order("name");return e?(console.error("Category fetch error:",e),[]):(console.log("Category fetch success."),r)},fetchSubCategories:async()=>{console.log("Fetching SubCategories...");const{data:r,error:e}=await a.from("sub_categories").select("*").order("name");return e?(console.error("Sub-category fetch error:",e),[]):(console.log("SubCategory fetch success."),r)},fetchSavedContextsWithFilter:async(r,e)=>{console.log("Fetching saved contexts with filter...");let t=a.from("extracted_content").select(`
    *,
    categories(name),
    sub_categories(name)
  `);r&&(t=t.eq("category_id",r)),e&&(t=t.eq("sub_category_id",e)),t=t.order("extracted_at",{ascending:!1});const{data:o,error:i}=await t;return i?(console.error("Fetch error:",i),[]):o},fetchSavedContexts:async()=>{console.log("Fetching saved contexts...");const{data:r,error:e}=await a.from("extracted_content").select("*").order("extracted_at",{ascending:!1});return e?(console.error("fetchSavedContexts error:",e),[]):(console.log("Fetched context records: ",r.length),r)},formatDate:x});export{I as N,Q as u};
