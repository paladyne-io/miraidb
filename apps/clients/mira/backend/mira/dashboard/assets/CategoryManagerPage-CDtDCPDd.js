import{Q as z}from"./QBtn-Dfw2kp-I.js";import{Q as te}from"./QCard-DSFwVwpM.js";import{l as _,ai as w,o as ae,m as se,n as V,e as u,d as t,y as p,ar as m,b as I,q as A,c as g,x as E,F as M,s as x,t as S}from"./mainRouter-D1MtaxKQ.js";import{u as oe}from"./useSupabaseCategoryManagement-A27IEB-S.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-dark-0IRRmxwP.js";const v=i=>i.replace(/<[^>]*>/g,"").trim(),q=i=>{const n=[];return i.name?i.name.length<2?n.push("Category name must be at least 2 characters long"):i.name.length>50&&n.push("Category name cannot exceed 50 characters"):n.push("Category name is required"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},ie=i=>{const n=[];return i.name?i.name.length<2?n.push("Subcategory name must be at least 2 characters long"):i.name.length>50&&n.push("Subcategory name cannot exceed 50 characters"):n.push("Subcategory name is required"),i.categoryId||n.push("A parent category must be selected"),i.description&&i.description.length>500&&n.push("Description cannot exceed 500 characters"),{isValid:n.length===0,errors:n}},re={class:"container"},le={class:"category-section"},ce={class:"add-category-card"},de={class:"input-group"},ue={class:"categories-grid"},pe={class:"category-header"},me={class:"category-actions"},ge=["onClick"],ye=["onClick"],ve={class:"category-description"},fe={class:"subcategory-section"},be={class:"add-subcategory-form"},Ce={key:0,class:"input-group"},he=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],Se={class:"subcategories-list"},ke={class:"subcategory-content"},De={class:"subcategory-name"},we={class:"subcategory-actions"},Ve=["onClick"],xe=["onClick"],Ue={class:"subcategory-description"},Ne={key:0,class:"modal"},Be={class:"modal-content"},Fe={key:1,class:"modal"},ze={class:"modal-content"},Ie={__name:"CategoryManagerPage",setup(i){const{error:n,user:Ae,fetchCurrentUser:P,fetchCategories:b,fetchSubCategories:k,addCategory:$,updateCategory:Q,deleteCategory:T,addSubcategory:j,deleteSubcategory:L,updateSubcategory:O}=oe(),y=_([]),C=_([]),d=w({name:"",description:""});w({});const r=_(null),l=_(null),c=w({}),Y=()=>{y.value.forEach(s=>{s.id in c||(c[s.id]={name:"",description:""})})},G=async()=>{const s=v(d.name),e=d.description?v(d.description):"",{isValid:a,errors:o}=q({name:s,description:e});if(!a){alert(o.join(`
`));return}await $(d.name,d.description)?(console.error("Add category success."),d.name="",d.description="",y.value=await b(),alert("The new category was added successfully.")):alert("Failed to add category.")},H=async s=>{if(!confirm("Are you sure you want to delete this category? This will also delete associated subcategories."))return;await T(s)?(console.error("Delete category success."),y.value=await b()):alert("Failed to delete category.")},J=s=>{r.value={...s}},U=async()=>{var h,D,B,F;if(!((h=r.value)!=null&&h.name.trim())){alert("Category name is required");return}const s=v((D=r.value)==null?void 0:D.name),e=(B=r.value)!=null&&B.description?v((F=r.value)==null?void 0:F.description):"",{isValid:a,errors:o}=q({name:s,description:e});if(!a){alert(o.join(`
`));return}await Q(r.value.id,r.value.name,r.value.description)?(console.error("Update category success."),r.value=null,y.value=await b()):alert("Failed to update category.")},N=()=>{r.value=null},K=async s=>{console.log("addSubcategoryInDB categoryId: "+s),c[s]||(c[s]={name:"",description:""});const e=c[s],a=v(e.name),o=e.description?v(e.description):"",{isValid:f,errors:h}=ie({name:a,description:o,categoryId:s});if(!f){alert(h.join(`
`));return}if(!e.name||!e.name.trim()){alert("Subcategory name is required");return}await j(s,e.name,e.description)?(console.log("Added subcategory."),c[s].name="",c[s].description="",C.value=await k()):alert("Failed to add subcategory.")},R=async s=>{if(!confirm("Are you sure you want to delete this subcategory?"))return;await L(s)?(console.error("Delete subcategory success."),C.value=await k()):alert("Failed to delete subcategory.")},W=s=>{l.value={...s}},X=async()=>{var e;if(!((e=l.value)!=null&&e.name.trim())){alert("Subcategory name is required");return}await O(l.value.id,l.value.name,l.value.description)?(console.error("Update subcategory success."),l.value=null):alert("Failed to update subcategory.")},Z=()=>{l.value=null},ee=async()=>{const s=await b();y.value=s||[];const e=await k();C.value=e||[],Y()};return ae(async()=>{if(console.log("CategoryManagerPage mounted."),!await P()){alert("You must be signed in to use this feature.");return}console.log("CategoryManagerPage mounted. Fetching categories..."),ee()}),(s,e)=>(u(),se(te,{class:"category-management"},{default:V(()=>[t("div",re,[e[13]||(e[13]=t("h1",{class:"page-title"},"Category Management",-1)),t("div",le,[t("div",ce,[e[7]||(e[7]=t("h3",{class:"category-title q-pb-md"},"Create a New Category",-1)),t("div",de,[p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.name=a),placeholder:"Category Name",type:"text",class:"form-input"},null,512),[[m,d.name]]),p(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.description=a),placeholder:"Category Description (Optional)",class:"form-textarea"},null,512),[[m,d.description]]),I(z,{onClick:G,class:"btn-primary"},{default:V(()=>e[6]||(e[6]=[t("i",{class:"fas fa-plus"},null,-1),A(" Add Category ")])),_:1}),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:N},"Cancel")])])]),t("div",ue,[(u(!0),g(M,null,E(y.value,a=>(u(),g("div",{key:a.id,class:"category-card"},[t("div",pe,[t("h3",null,S(a.name),1),t("div",me,[t("button",{onClick:o=>J(a),class:"btn-edit"},e[8]||(e[8]=[t("i",{class:"fas fa-edit"},null,-1)]),8,ge),t("button",{onClick:o=>H(a.id),class:"btn-delete"},e[9]||(e[9]=[t("i",{class:"fas fa-trash"},null,-1)]),8,ye)])]),t("p",ve,S(a.description||"No description"),1),t("div",fe,[t("div",be,[c[a.id]?(u(),g("div",Ce,[p(t("input",{"onUpdate:modelValue":o=>c[a.id].name=o,placeholder:"Subcategory Name",class:"form-input"},null,8,he),[[m,c[a.id].name]]),p(t("textarea",{"onUpdate:modelValue":o=>c[a.id].description=o,placeholder:"Subcategory Description",class:"form-textarea"},null,8,_e),[[m,c[a.id].description]]),I(z,{onClick:o=>K(a.id),class:"btn-secondary"},{default:V(()=>e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),A(" Add Subcategory ")])),_:2},1032,["onClick"])])):x("",!0)]),t("div",Se,[(u(!0),g(M,null,E(C.value.filter(o=>o.category_id===a.id),o=>(u(),g("div",{key:o.id,class:"subcategory-item"},[t("div",ke,[t("span",De,S(o.name),1),t("div",we,[t("button",{onClick:f=>W(o),class:"btn-edit-small"},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ve),t("button",{onClick:f=>R(o.id),class:"btn-delete-small"},e[12]||(e[12]=[t("i",{class:"fas fa-trash"},null,-1)]),8,xe)])]),t("p",Ue,S(o.description||"No description"),1)]))),128))])])]))),128))])])]),r.value?(u(),g("div",Ne,[t("div",Be,[e[14]||(e[14]=t("h2",null,"Edit Category",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"Category Name"},null,512),[[m,r.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.description=a),placeholder:"Category Description"},null,512),[[m,r.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:U},"Save"),t("button",{onClick:N},"Cancel")])])])):x("",!0),l.value?(u(),g("div",Fe,[t("div",ze,[e[15]||(e[15]=t("h2",null,"Edit Subcategory",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.name=a),placeholder:"Subcategory Name"},null,512),[[m,l.value.name]]),p(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.description=a),placeholder:"Subcategory Description"},null,512),[[m,l.value.description]]),t("div",{class:"modal-actions"},[t("button",{onClick:X},"Save"),t("button",{onClick:Z},"Cancel")])])])):x("",!0)]),_:1}))}},Te=ne(Ie,[["__scopeId","data-v-4ba07882"]]);export{Te as default};
